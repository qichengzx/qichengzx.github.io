
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>

  å¯ç¨‹
  

</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<link href="/css/style.css" rel="stylesheet" type="text/css">
<meta property="og:type" content="website">
<meta property="og:title" content="å¯ç¨‹">
<meta property="og:url" content="https://qichengzx.github.io">
<meta property="og:site_name" content="å¯ç¨‹">
<meta property="og:description" content="è®°å½•å†™ä»£ç è¿‡ç¨‹ä¸­çš„æˆé•¿ï¼Œä¸è¦æŠŠä½ ä»…çŸ¥é“çš„é‚£ä¸€ç‚¹ç‚¹ä¸œè¥¿å½“æˆå…¨ä¸–ç•Œ">
<link rel="icon" href="/favicon.ico">

</head>
<body>
<div id="container">
  <div id="wrap">
    
        <header id="header">
          <div id="banner"></div>
          <div id="header-outer" class="outer">
            <div id="header-title" class="inner">
              <h1 id="logo-wrap">
                <a href="https://qichengzx.github.io" id="logo">å¯ç¨‹</a>
              </h1>
              
            </div>
            <div id="header-inner" class="inner">
              <nav id="main-nav">
                <a id="main-nav-toggle" class="nav-icon"></a>
                
                <a class="main-nav-link" href="/">Home</a>
                
                <a class="main-nav-link" href="/archives">Archives</a>
                
                <a class="main-nav-link" href="https://github.com/qichengzx">GitHub</a>
                
              </nav>
              <nav id="sub-nav">
              
                <a id="nav-search-btn" class="nav-icon" title="Search"></a>
              </nav>
              <div id="search-form-wrap">
                <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form">
                  <input type="search" name="q" class="search-form-input" placeholder="Search">
                  <button type="submit" class="search-form-submit">&#xF002;</button>
                  <input type="hidden" name="sitesearch" value="https://qichengzx.github.io">
                </form>
              </div>
            </div>
          </div>
        </header>

    <div class="outer">
      <section id="main">
      
        
        
                <article id="53a81c5866df79c1059ad054622e0b12" class="article" itemscope itemprop="blogPost">
                  <div class="article-meta">
                    <a href="https://qichengzx.github.io/2025/01/12/08-rustlings-enums.html" class="article-date">
                      <time itemprop="datePublished">2025-01-12 12:00:52</time>
                    </a>
                    <div class="article-category">
                      <a class="article-category-link" href="/categories/default">default</a>
                    </div>
                  </div>
                  <div class="article-inner">
                    <header class="article-header">
                      <h1 itemprop="name">
                        <a class="article-title" href="https://qichengzx.github.io/2025/01/12/08-rustlings-enums.html">08-rustlings-enums</a>
                      </h1>
                    </header>
                    <div class="article-entry" itemprop="articleBody">
                      <h4>enums1.rs</h4>

<p>åŸå§‹ä»£ç ï¼š</p>

<pre><code class="language-rust">#[derive(Debug)]
enum Message {
    // TODO: Define a few types of messages as used below.
}

fn main() {
    println!(&quot;{:?}&quot;, Message::Resize);
    println!(&quot;{:?}&quot;, Message::Move);
    println!(&quot;{:?}&quot;, Message::Echo);
    println!(&quot;{:?}&quot;, Message::ChangeColor);
    println!(&quot;{:?}&quot;, Message::Quit);
}

</code></pre>

<p>ç¼–è¯‘æŠ¥é”™å†…å®¹ï¼š</p>

<pre><code class="language-shell">error[E0599]: no variant or associated item named `Resize` found for enum `Message` in the current scope
 --&gt; exercises/08_enums/enums1.rs:7:31
  |
2 | enum Message {
  | ------------ variant or associated item `Resize` not found for this enum
...
7 |     println!(&quot;{:?}&quot;, Message::Resize);
  |                               ^^^^^^ variant or associated item not found in `Message`

error[E0599]: no variant or associated item named `Move` found for enum `Message` in the current scope
 --&gt; exercises/08_enums/enums1.rs:8:31
  |
2 | enum Message {
  | ------------ variant or associated item `Move` not found for this enum
...
8 |     println!(&quot;{:?}&quot;, Message::Move);
  |                               ^^^^ variant or associated item not found in `Message`

error[E0599]: no variant or associated item named `Echo` found for enum `Message` in the current scope
 --&gt; exercises/08_enums/enums1.rs:9:31
  |
2 | enum Message {
  | ------------ variant or associated item `Echo` not found for this enum
...
9 |     println!(&quot;{:?}&quot;, Message::Echo);
  |                               ^^^^ variant or associated item not found in `Message`

error[E0599]: no variant or associated item named `ChangeColor` found for enum `Message` in the current scope
  --&gt; exercises/08_enums/enums1.rs:10:31
   |
2  | enum Message {
   | ------------ variant or associated item `ChangeColor` not found for this enum
...
10 |     println!(&quot;{:?}&quot;, Message::ChangeColor);
   |                               ^^^^^^^^^^^ variant or associated item not found in `Message`

error[E0599]: no variant or associated item named `Quit` found for enum `Message` in the current scope
  --&gt; exercises/08_enums/enums1.rs:11:31
   |
2  | enum Message {
   | ------------ variant or associated item `Quit` not found for this enum
...
11 |     println!(&quot;{:?}&quot;, Message::Quit);
   |                               ^^^^ variant or associated item not found in `Message`

For more information about this error, try `rustc --explain E0599`.
error: could not compile `exercises` (bin &quot;enums1&quot;) due to 5 previous errors

</code></pre>

<p>è¿™ä¸€èŠ‚çš„æŠ¥é”™å·²ç»å¾ˆæ˜æ˜¾ï¼Œæ¯ä¸€ä¸ªé”™è¯¯éƒ½æœ‰æç¤ºï¼Œé‚£ä¹ˆæ ¹æ®æç¤ºå¯ä»¥çœ‹åˆ°ï¼Œ<code>Message</code>æšä¸¾ç¼ºå°‘å­—æ®µï¼Œæ‰€ä»¥è¡¥å…¨å­—æ®µå³å¯ï¼š</p>

<pre><code class="language-shell">error[E0599]: no variant or associated item named `Resize` found for enum `Message` in the current scope
 --&gt; exercises/08_enums/enums1.rs:7:31
  |
2 | enum Message {
  | ------------ variant or associated item `Resize` not found for this enum
</code></pre>

<p>æ ¹æ®main ä¸­çš„é€»è¾‘å¯ä»¥å¾—çŸ¥ï¼Œéœ€è¦æœ‰<code>Resize</code>,<code>Move</code>,<code>Echo</code>,<code>ChangeColor</code>å’Œ<code>Quit</code>ã€‚</p>

<p>è¡¥å…¨åï¼š</p>

<pre><code class="language-rust">#[derive(Debug)]
enum Message {
    // TODO: Define a few types of messages as used below.
    Resize,
    Move,
    Echo,
    ChangeColor,
    Quit,
}

</code></pre>

<p>å°†ä¼šè¾“å‡ºï¼š</p>

<pre><code class="language-shell">Output
Resize
Move
Echo
ChangeColor
Quit


Exercise done âœ“
Solution for comparison: solutions/08_enums/enums1.rs
When done experimenting, enter `n` to move on to the next exercise ğŸ¦€

Progress: [################################################################&gt;-----------------------------------------------------------------------------------------------------------------------]  33/94
Current exercise: exercises/08_enums/enums1.rs

</code></pre>

                    </div>
                    <footer class="article-footer">
                      <a href="https://qichengzx.github.io/2025/01/12/08-rustlings-enums.html#comments" class="article-comment-link">Comments</a>
                      
                        <ul class="article-tag-list">
                        
                          <li class="article-tag-list-item">
                            <a class="article-tag-list-link" href="/tags/rust">rust</a>
                          </li>
                        
                        </ul>
                      
                    </footer>
                  </div>
                  <nav id="article-nav">
                    

                    
                  </nav>
                </article>

        
        
                <article id="37e6ad89f012b41081720afaf9458635" class="article" itemscope itemprop="blogPost">
                  <div class="article-meta">
                    <a href="https://qichengzx.github.io/2021/07/18/pipeline-pattern-in-go-part-1.html" class="article-date">
                      <time itemprop="datePublished">2021-07-18 11:58:49</time>
                    </a>
                    <div class="article-category">
                      <a class="article-category-link" href="/categories/default">default</a>
                    </div>
                  </div>
                  <div class="article-inner">
                    <header class="article-header">
                      <h1 itemprop="name">
                        <a class="article-title" href="https://qichengzx.github.io/2021/07/18/pipeline-pattern-in-go-part-1.html">Go æµæ°´çº¿æ¨¡å¼</a>
                      </h1>
                    </header>
                    <div class="article-entry" itemprop="articleBody">
                      <p>æˆ‘å°†æŠŠè¿™ç¯‡æ–‡ç« åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œåœ¨ç¬¬ä¸€éƒ¨åˆ†æˆ‘å°†å°è¯•è§£é‡Šç®¡é“çš„åŸºæœ¬æ„å»ºå—ï¼Œåœ¨ç¬¬äºŒç¯‡æ–‡ç« ä¸­æˆ‘å°†å°è¯•å›´ç»•è¿™ä¸ªè®¾è®¡æ„å»ºä¸€ä¸ªé€šç”¨åº“ã€‚</p>

<p>æˆ‘æœ€è¿‘åœ¨é˜…è¯»<a href="https://learning.oreilly.com/library/view/concurrency-in-go/9781491941294/">Concurrency In Go</a>æ—¶é‡åˆ°äº†ä¸€ç§å«åšç®¡é“å¤„ç†æ¨¡å¼çš„ä¸œè¥¿ã€‚æƒ³æ³•æ˜¯æ‚¨å¯ä»¥å°†é€»è¾‘åŠŸèƒ½åˆ†è§£ä¸ºå¤šä¸ªé˜¶æ®µã€‚æ¯ä¸ªé˜¶æ®µéƒ½è¿›è¡Œè‡ªå·±çš„å¤„ç†ï¼Œå¹¶å°†è¾“å‡ºä¼ é€’åˆ°ä¸‹ä¸€ä¸ªé˜¶æ®µè¿›è¡Œå¤„ç†ã€‚æ‚¨å¯ä»¥ä¿®æ”¹å½¼æ­¤ç‹¬ç«‹çš„é˜¶æ®µï¼Œé™åˆ¶é˜¶æ®µçš„é€Ÿç‡ç­‰ç­‰ã€‚</p>

<h2>ç®¡é“åŸºç¡€çŸ¥è¯†</h2>

<p>æ¥çœ‹ä¸‹è¿™ä¸¤ä¸ªå‡½æ•°ï¼š</p>

<pre><code class="language-Go">func Multiply(value ,multiplier int) int { 
	return value*multiplier
}
func Add(value,additive int) int { 
	return value+additive
}
</code></pre>

<p>è¿™ä¸¤ä¸ªå‡½æ•°å¾ˆç®€å•ï¼Œåªæ˜¯å¯¹æ•°å­—è¿›è¡Œè¿ç®—å¹¶è¿”å›å®ƒã€‚æ‚¨å¯ä»¥å°†è¿™äº›è§†ä¸ºç®¡é“çš„â€œé˜¶æ®µâ€ã€‚ä¸ºäº†å®Œæˆç®¡é“ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸¤ä¸ªé˜¶æ®µç»“åˆèµ·æ¥ã€‚</p>

<pre><code class="language-Go">ints := []int{1,2,3,4}

for _,v := range ints {
	fmt.Println(multiply(add(multiply(v,2),1),2))
}
</code></pre>

<p>åœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ° stage å¤„ç†è¾“å…¥ï¼Œå¤„ç†åè¿”å›ç›¸åŒçš„ç±»å‹ä»¥ä¾›è¿›ä¸€æ­¥çš„ stage å¤„ç†ã€‚</p>

<h2>å¹¶å‘ç®¡é“</h2>

<p>è¿™ä¸ªç®€å•çš„æ¨¡å‹ç°åœ¨å¯ä»¥æ‰©å±•åˆ°åˆ©ç”¨ go çš„é€šé“å’Œ goroutines æ¥åŒæ—¶æ‰§è¡Œé˜¶æ®µçš„å¤„ç†ã€‚åœ¨æˆ‘ä»¬è¿™æ ·åšä¹‹å‰ï¼Œæˆ‘ä»¬çš„ç®¡é“ä¸­å¿…é¡»æœ‰ä»¥ä¸‹å®ä½“ã€‚</p>

<ul>
<li><p>Generatorï¼Œå®ƒå°†è´Ÿè´£ç”Ÿæˆç®¡é“å¤„ç†çš„è¾“å…¥ã€‚è¿™æ˜¯ç®¡é“çš„ç¬¬ä¸€é˜¶æ®µã€‚</p></li>

<li><p>é˜¶æ®µï¼Œå¯ä»¥åœ¨å…¶ä¸­æ‰§è¡Œå®é™…å¤„ç†ã€‚</p></li>

<li><p>Cancellerï¼Œä¸€ç§é€šè¿‡ç®¡é“å‘å‡ºå–æ¶ˆæˆ–å¤„ç†ç»“æŸä¿¡å·çš„æœºåˆ¶ã€‚</p></li>
</ul>

<p>è®©æˆ‘ä»¬ä»ç”Ÿæˆå™¨å¼€å§‹</p>

<pre><code class="language-Go">func generator(done &lt;-chan interface{}, integers ...int) &lt;-chan int {
	intStream := make(chan int)
	go func() {
		defer close(intStream)
		for _, i := range integers {
			select {
			case &lt;-done: return
			case intStream &lt;- i:
			}
		}

	}()
	return intStream
}
</code></pre>

<p>è¿™ä¸ªå‡½æ•°å°†ç”Ÿæˆä¸€ä¸ª goroutineï¼Œå®ƒå°†åœ¨ä¸€ä¸ªé€šé“ä¸Šç”Ÿæˆæ•°å€¼ï¼Œå¹¶ä¸”è¯¥å‡½æ•°åªæ˜¯ç®€å•åœ°è¿”å›é‚£ä¸ªé€šé“ã€‚åœ¨æ­¤é€šé“ä¸Šç”Ÿæˆçš„å€¼ç”¨ä½œè¿›ä¸€æ­¥é˜¶æ®µçš„è¾“å…¥ã€‚æˆ‘ä»¬è¿˜åœ¨å‡½æ•°ä¸­ä¼ é€’äº† done é€šé“æ¥é€€å‡ºç”Ÿæˆæµç¨‹ï¼Œè¿™ä¹Ÿç§°ä¸ºæ¯’ä¸¸æ¨¡å¼(<a href="https://java-design-patterns.com/patterns/poison-pill/">Poison Pill Pattern</a>)</p>

<p>æ‰©å±•ç›¸åŒçš„æƒ³æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é‡å†™ä¹˜æ³•å’ŒåŠ æ³•å‡½æ•°æ¥å¹¶å‘å¤„ç†ã€‚</p>

<pre><code class="language-Go">func multiply(done &lt;-chan interface{}, intStream &lt;-chan int, multiplier int) chan int {
	multipliedStream := make(chan int)
	go func() {
		defer close(multipliedStream)
		for i := range intStream {
			select {
			case &lt;-done: return
			case multipliedStream &lt;- i * multiplier:
			}
		}
	}()
	return multipliedStream
}

func add(done &lt;-chan interface{}, intStream &lt;-chan int, adder int) chan int {
	addedStream := make(chan int)
	go func() {
		defer close(addedStream)
		for i := range intStream {
			select {
			case &lt;-done:return
			case addedStream &lt;- i * adder:
			}
		}
	}()
	return addedStream
}
</code></pre>

<p>æ—æ³¨ï¼šä¹Ÿè®¸æˆ‘ä»¬å¯ä»¥é‡å†™è¿™äº›å‡½æ•°æ¥æ¥å—æ¥å£æˆ–å‡½æ•°ï¼Œè€Œä¸æ˜¯ç¼–å†™ä¸¤æ¬¡å…±äº«å¤§éƒ¨åˆ†ä»£ç çš„å‡½æ•°ï¼Œä½†æˆ‘è¯•å›¾åœ¨è¿™é‡Œä¿æŒç®€å•ã€‚</p>

<p>ä¸ºäº†æ„å»ºç®¡é“ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç®¡é“çš„è¿™äº›é˜¶æ®µç»„åˆä¸ºå¦‚ä¸‹å½¢å¼ï¼š</p>

<pre><code class="language-Go">done := make(chan interface{})
intStream := generator(done, 1, 2, 3, 4)

pipeline := add(done, multiply(done, intStream, 2), 5)

for i := range pipeline {
    fmt.Println(i)
}
</code></pre>

<p>è¿™æ®µä»£ç å°†åœ¨ä¸åŒçš„ç®¡é“ä¸­åŒæ—¶è¿è¡Œé˜¶æ®µï¼Œé€šè¿‡ go é€šé“å°†å®ƒä»¬çš„ç»“æœä¼ é€’åˆ°ä¸‹ä¸€ä¸ªé˜¶æ®µã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡é˜…è¯»æœ€åé˜¶æ®µçš„é¢‘é“æ¥è·å¾—æœ€ç»ˆç»“æœã€‚</p>

<h2>æ›´å®é™…çš„ç”¨ä¾‹</h2>

<p>å¥½çš„ï¼Œä½†æ˜¯æ›´å®ç”¨çš„ä¸œè¥¿æ€ä¹ˆæ ·ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ç§è®¾è®¡å®ç°ä¸€ä¸ªshopifyçš„çˆ¬è™«ã€‚ç›®çš„æ˜¯æŠ“å–shopifyé¡µé¢å¹¶æŠ“å–æœ‰ç”¨çš„ä¿¡æ¯ã€‚</p>

<p>è¿™æ˜¯æˆ‘ä»¬å¯ä»¥éµå¾ªçš„åŸºæœ¬è®¾è®¡ç®—æ³•ã€‚</p>

<p>è½¬åˆ°åº”ç”¨ç¨‹åºç›®å½•é¡µé¢ï¼Œä¾‹å¦‚<a href="https://apps.shopify.com/browse/all?page=1">https://apps.shopify.com/browse/all?page=1</a></p>

<p><img src="/images/pipeline/noNqhT8.png" alt="" /></p>

<p>ä»æ¯ä¸ªåº”ç”¨ç¨‹åºç›®å½•é¡µé¢æŠ“å–ä¸åŒåº”ç”¨ç¨‹åºçš„ URLã€‚</p>

<p>è®¿é—®æ¯ä¸ªåº”ç”¨ URL æŠ“å–åº”ç”¨ä¿¡æ¯å¹¶å¡«å……æˆ‘ä»¬çš„ç»“æ„ã€‚</p>

<p><img src="/images/pipeline/NxPEgfB.png" alt="" /></p>

<p>éå†åˆ†é¡µä»¥è½¬åˆ°ä¸‹ä¸€ä¸ªåº”ç”¨ç¨‹åºç›®å½•é¡µé¢å¹¶é‡å¤ã€‚</p>

<p>åœ¨ç®¡é“æ–¹é¢ï¼Œæˆ‘ä»¬éœ€è¦æ„å»ºè¿™æ ·çš„ä¸œè¥¿</p>

<p><img src="/images/pipeline/qTBtL19.png" alt="" /></p>

<p>è®©æˆ‘ä»¬å®šä¹‰ App ç»“æ„</p>

<pre><code class="language-Go">type App struct {
    Rating     float64
    Review     int
    Name       string
    Category   []string
    AppLink    string
    PageLink   string
}
</code></pre>

<p>æˆ‘æ²¡æœ‰ç¼–å†™å®é™…çš„æŠ“å–ä»£ç æ¥ä¿æŒç®€çŸ­å’Œç®€å•ï¼Œä½†æ˜¯å¯ä»¥è½»æ¾å¢åŠ æŠ“å–é€»è¾‘è€Œæ— éœ€æ›´æ”¹ä»£ç ç»“æ„ã€‚</p>

<pre><code class="language-Go">
type ShopifyScraper struct {}



// Generation Stage, This stage will generate app directory URLs.
func (s *ShopifyScraper) Generate(done &lt;-chan bool) chan App {

	links := make(chan App)
	go func() {
		defer close(links)
		for i := 0; i &lt; 5; i++ {
			select {
			case &lt;-done: return
			case links &lt;- App{PageLink: fmt.Sprintf(&quot;https://apps.shopify.com/browse/all?page=%d&quot;, i)}:
			}
		}
	}()
	return links
}

// App Directory Scraper Stage, This stage will visit directory page and scrape different app URLs from the page for further processing.
func (s *ShopifyScraper) AppDirectoryScraper(done &lt;-chan bool, input &lt;-chan App) chan App {

	apps := make(chan App, 5)
	go func() {
		defer close(apps)
		for app := range input {

			// Extract Different App URLs by scraping  using app.PageLink

			select {
			case &lt;-done: return
			case apps &lt;- app:
			}
		}
	}()
	return apps
}

// App Scraper Stage, This stage will visit app page and scrape app information
func (s *ShopifyScraper) AppScraper(done &lt;-chan bool, input &lt;-chan App) chan App {
	apps := make(chan App)
	go func() {
		defer close(apps)
		for app := range input {
			
			// Extract Different App Information by scraping by using app.AppLink
			
			select {
			case &lt;-done: return
			case apps &lt;- app:

			}
		}
	}()
	return apps
}
</code></pre>

<p>æœ€åï¼Œå°†å„ä¸ªé˜¶æ®µè¿æ¥åœ¨ä¸€èµ·ä»¥å½¢æˆç®¡é“ã€‚</p>

<pre><code class="language-Go">func (s *ShopifyScraper) Do() []AppInfo {

	var result []AppInfo
	done := make(chan bool)
	defer close(done)

	for i := range s.AppScraper(done, s.AppDirectoryScraper(done, s.Generate(done))) {
		result = append(result, i)
	}
	return result
}
</code></pre>

<p>åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†å°è¯•å°†ç®¡é“æ„å»ºä¸ºä¸€ä¸ªåº“ï¼Œå®ƒå¯ä»¥å¤„ç† (1) ç®¡é“æ’åº (2) åœ¨å¤šä¸ª goroutine ä¸­åŒæ—¶æ‰§è¡ŒåŒä¸€é˜¶æ®µ (3) å–æ¶ˆ (4) å¯èƒ½çš„é”™è¯¯å¤„ç†/é‡è¯•</p>

<h2>åŸæ–‡é“¾æ¥</h2>

<p><a href="https://ketansingh.me/posts/pipeline-pattern-in-go-part-1/">Pipeline Pattern in Go Part 1</a></p>

                    </div>
                    <footer class="article-footer">
                      <a href="https://qichengzx.github.io/2021/07/18/pipeline-pattern-in-go-part-1.html#comments" class="article-comment-link">Comments</a>
                      
                        <ul class="article-tag-list">
                        
                          <li class="article-tag-list-item">
                            <a class="article-tag-list-link" href="/tags/go">go</a>
                          </li>
                        
                        </ul>
                      
                    </footer>
                  </div>
                  <nav id="article-nav">
                    

                    
                  </nav>
                </article>

        
        
                <article id="0d027961b52d0be2f9036355eaf42e99" class="article" itemscope itemprop="blogPost">
                  <div class="article-meta">
                    <a href="https://qichengzx.github.io/2021/01/01/unmarshaling-time-values-from-json.html" class="article-date">
                      <time itemprop="datePublished">2021-01-01 10:16:26</time>
                    </a>
                    <div class="article-category">
                      <a class="article-category-link" href="/categories/golang">golang</a>
                    </div>
                  </div>
                  <div class="article-inner">
                    <header class="article-header">
                      <h1 itemprop="name">
                        <a class="article-title" href="https://qichengzx.github.io/2021/01/01/unmarshaling-time-values-from-json.html">Go json æ—¶é—´æ ¼å¼è§£æ</a>
                      </h1>
                    </header>
                    <div class="article-entry" itemprop="articleBody">
                      <h3>é»˜è®¤RFC 3339</h3>

<p>åœ¨Goä¸­ï¼Œè§£æjsonçš„æ—¶é—´æ ¼å¼é»˜è®¤æ˜¯<a href="https://tools.ietf.org/html/rfc3339">RFC 3339</a>ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ struct è½¬ jsonï¼Œæˆ– json è½¬å› structéƒ½æ²¡æœ‰é—®é¢˜ã€‚</p>

<pre><code class="language-Go">type Data struct {
	Name    string    `json:&quot;name&quot;`
	Started time.Time `json:&quot;started&quot;`
}

var jsonStr = []byte(`
{
  &quot;name&quot;: &quot;new year&quot;,
  &quot;started&quot;: &quot;2021-01-01T00:00:00.000+08:00&quot;
}`)

func main() {
	var data Data
	if err := json.Unmarshal(jsonStr, &amp;data); err != nil {
		log.Fatal(err)
	}

	fmt.Printf(&quot;%+v\n&quot;, data)
}
</code></pre>

<h3>Z,T</h3>

<p>ä¸Šè¿°ä»£ç ä¸­ï¼Œæ—¥æœŸå’Œæ—¶é—´ä½¿ç”¨<code>T</code>åˆ†éš”å¼€ï¼Œå…¶å® RFC 3339è§„èŒƒä¸­å…è®¸ä½¿ç”¨ç©ºæ ¼åˆ†éš”ï¼Œç›®å‰Goçš„timeåŒ…è¿˜æ˜¯ä½¿ç”¨<code>T</code>åˆ†éš”ã€‚</p>

<p>+8:00åˆ™è¡¨ç¤ºæ—¶åŒºï¼Œå¦‚æœä¸æƒ³ä½¿ç”¨æ—¶åŒºï¼Œå¯ä»¥ä½¿ç”¨<code>Z</code>ä»£æ›¿ï¼š<code>2021-01-01T00:00:00.000Z</code>ã€‚</p>

<p>è¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨Goä¸­ï¼ŒRFC 3339çš„å®šä¹‰æ˜¯ï¼š</p>

<pre><code class="language-Go">RFC3339     = &quot;2006-01-02T15:04:05Z07:00&quot;
</code></pre>

<p>ä½†æ˜¯å¦‚æœè¿™æ ·å†™ï¼Œå´ä¸è¡Œã€‚</p>

<pre><code class="language-Go">t, err := time.Parse(time.RFC3339, time.RFC3339)
if err != nil {
	log.Fatal(err)
}
fmt.Println(t)
</code></pre>

<p>ä¼šæŠ¥é”™ï¼š&rdquo;parsing time &ldquo;2006-01-02T15:04:05Z07:00&rdquo;: extra text: 07:00&rdquo;ã€‚</p>

<p>ä½†æ˜¯å¦‚æœæ˜¯æŠŠä¸Šè¿°jsonçš„æ—¶é—´å€¼ä¿®æ”¹æˆ<code>2021-01-01T00:00:00.000Z</code>å°±æ²¡æœ‰é—®é¢˜ã€‚</p>

<h3>æ ¼å¼</h3>

<p>é»˜è®¤çš„æ—¶é—´æ ¼å¼æ˜¯RFC 3339ï¼Œå¦‚æœæƒ³æ¢æˆå…¶ä»–æ ¼å¼ï¼Œéœ€è¦è‡ªå·±å®ç°ã€‚</p>

<p>å…ˆçœ‹ä¸€ä¸‹æ—¶é—´æ ¼å¼çš„<a href="https://pkg.go.dev/time#pkg-constants">å®šä¹‰</a></p>

<p>ä¸€èˆ¬æƒ…å†µä¸‹æ ¼å¼åŒ–æ—¶é—´å¯ä»¥è¿™æ ·åšï¼š</p>

<pre><code class="language-GO">t, err := time.Parse(&quot;2006-01-02&quot;, &quot;2021-01-01&quot;)
</code></pre>

<p>ä½†æ˜¯å¦‚æœæƒ³ä»jsonä¸­è§£ææˆä¸åŒæ ¼å¼ï¼Œéœ€è¦è‡ªå·±å®ç°<code>json.Unmarshaler</code>æ¥å£ã€‚</p>

<pre><code class="language-Go">type MyTime struct {
	time.Time
}

const layout = &quot;2006-01-02&quot;

func (ct *MyTime) UnmarshalJSON(b []byte) (err error) {
	s := strings.Trim(string(b), &quot;\&quot;&quot;)
	if s == &quot;null&quot; {
		ct.Time = time.Time{}
		return
	}
	ct.Time, err = time.Parse(layout, s)
	return
}

</code></pre>

<p>ç„¶åï¼Œå°±å¯ä»¥ä½¿ç”¨è‡ªå·±çš„æ—¶é—´ç±»å‹äº†ã€‚</p>

<pre><code class="language-Go">
type Data struct {
	Name    string `json:&quot;name&quot;`
	Started MyTime `json:&quot;started&quot;`
}

var jsonStr = []byte(`
{
  &quot;name&quot;: &quot;new year&quot;,
  &quot;started&quot;: &quot;2021-01-01&quot;
}`)

func main() {
	var data Data
	if err := json.Unmarshal(jsonStr, &amp;data); err != nil {
		log.Fatal(err)
	}

	fmt.Printf(&quot;%+v\n&quot;, data)
}
</code></pre>

                    </div>
                    <footer class="article-footer">
                      <a href="https://qichengzx.github.io/2021/01/01/unmarshaling-time-values-from-json.html#comments" class="article-comment-link">Comments</a>
                      
                        <ul class="article-tag-list">
                        
                          <li class="article-tag-list-item">
                            <a class="article-tag-list-link" href="/tags/go">go</a>
                          </li>
                        
                        </ul>
                      
                    </footer>
                  </div>
                  <nav id="article-nav">
                    

                    
                  </nav>
                </article>

        
        
                <article id="183924edfb3af6d50e5fbb2470d95e78" class="article" itemscope itemprop="blogPost">
                  <div class="article-meta">
                    <a href="https://qichengzx.github.io/2020/02/02/graceful-shutdown-of-a-tcp-server-in-go.html" class="article-date">
                      <time itemprop="datePublished">2020-02-02 11:15:48</time>
                    </a>
                    <div class="article-category">
                      <a class="article-category-link" href="/categories/golang">golang</a>
                    </div>
                  </div>
                  <div class="article-inner">
                    <header class="article-header">
                      <h1 itemprop="name">
                        <a class="article-title" href="https://qichengzx.github.io/2020/02/02/graceful-shutdown-of-a-tcp-server-in-go.html">ä¼˜é›…çš„å…³é—­Go TCP Server</a>
                      </h1>
                    </header>
                    <div class="article-entry" itemprop="articleBody">
                      <p>æœ¬æ–‡å°†è®¨è®ºå¦‚ä½•åœ¨Goä¸­ä¼˜é›…åœ°å…³é—­TCPæœåŠ¡å™¨ã€‚è™½ç„¶æœåŠ¡å™¨é€šå¸¸ä¸ä¼šåœæ­¢è¿è¡Œï¼ˆç›´åˆ°è¿›ç¨‹ç»ˆæ­¢ï¼‰ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼ˆä¾‹å¦‚åœ¨æµ‹è¯•ä¸­ï¼‰ï¼Œä»¥æœ‰åºçš„æ–¹å¼å…³é—­å®ƒä»¬æ˜¯æœ‰ç”¨çš„ã€‚</p>

<h2>Go TCP serverçš„é«˜çº§ç»“æ„</h2>

<p>æˆ‘ä»¬å…ˆå¿«é€Ÿå›é¡¾ä¸€ä¸‹Goä¸­å®ç°çš„TCPæœåŠ¡å™¨çš„é«˜å±‚ç»“æ„ã€‚Goåœ¨å¥—æ¥å­—çš„é¡¶å±‚æä¾›äº†ä¸€äº›æ–¹ä¾¿çš„æŠ½è±¡ã€‚ä¸‹é¢æ˜¯å…¸å‹æœåŠ¡å™¨çš„ä¼ªä»£ç ï¼š</p>

<pre><code class="language-go">listener := net.Listen(&quot;tcp&quot;, ... address ...)
for {
  conn := listener.Accept()
  go handler(conn)
}
</code></pre>

<p>å…¶ä¸­<code>handler</code>æ˜¯ä¸€ä¸ªé˜»å¡å‡½æ•°ï¼Œå®ƒç­‰å¾…æ¥è‡ªå®¢æˆ·ç«¯çš„å‘½ä»¤ï¼Œæ‰§è¡Œæ‰€éœ€çš„å¤„ç†ï¼Œå¹¶å°†å“åº”å‘é€å›ã€‚</p>

<p>é‰´äºè¿™ç§ç»“æ„ï¼Œæˆ‘ä»¬åº”è¯¥æ˜ç™½â€œå…³é—­æœåŠ¡å™¨â€çš„å«ä¹‰ã€‚æœåŠ¡å™¨åœ¨ä»»ä½•ç»™å®šæ—¶é—´éƒ½æ‰§è¡Œä¸¤ç§ä¸åŒçš„åŠŸèƒ½ï¼š</p>

<ol>
<li>å®ƒç›‘å¬æ–°çš„è¿æ¥</li>
<li>å®ƒå¤„ç†å·²æœ‰è¿æ¥</li>
</ol>

<p>å¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬å¯ä»¥åœæ­¢ç›‘å¬æ–°çš„è¿æ¥ï¼Œä»è€Œå¤„ç†ï¼ˆ1ï¼‰ï¼›ä½†æ˜¯ç°æœ‰çš„è¿æ¥å‘¢ï¼Ÿ</p>

<p>ä¸å¹¸çš„æ˜¯ï¼Œè¿™é‡Œæ²¡æœ‰ç®€å•çš„ç­”æ¡ˆã€‚TCPåè®®çº§åˆ«å¤ªä½ï¼Œæ— æ³•æœ€ç»ˆè§£å†³æ­¤é—®é¢˜ã€‚å¦‚æœæˆ‘ä»¬æƒ³è®¾è®¡ä¸€ä¸ªå¹¿æ³›é€‚ç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä»¬å¿…é¡»ä¿å®ˆã€‚å…·ä½“æ¥è¯´ï¼Œæœ€å®‰å…¨çš„æ–¹æ³•æ˜¯å…³é—­æœåŠ¡å™¨ä»¥ç­‰å¾…å®¢æˆ·ç«¯å…³é—­å…¶è¿æ¥ã€‚è¿™æ˜¯æˆ‘ä»¬å°†é¦–å…ˆç ”ç©¶çš„æ–¹æ³•ã€‚</p>

<h2>æ­¥éª¤1:ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥å…³é—­</h2>

<p>åœ¨è¿™ä¸ªè§£å†³æ–¹æ¡ˆä¸­ï¼Œæˆ‘ä»¬å°†æ˜¾å¼åœ°å…³é—­ä¾¦å¬å™¨ï¼ˆåœæ­¢æ¥å—æ–°è¿æ¥ï¼‰ï¼Œç­‰å¾…å®¢æˆ·ç«¯ç»“æŸå…¶è¿æ¥ã€‚è¿™æ˜¯ä¸€ç§ä¿å®ˆçš„æ–¹æ³•ï¼Œä½†å®ƒåœ¨è®¸å¤šå®é™…éœ€è¦å…³é—­æœåŠ¡å™¨çš„åœºæ™¯ï¼ˆå¦‚æµ‹è¯•ï¼‰ä¸­éå¸¸æœ‰æ•ˆã€‚åœ¨æµ‹è¯•ä¸­ï¼Œä½¿æ‰€æœ‰å®¢æˆ·ç«¯åœ¨é¢„æœŸæœåŠ¡å™¨å…³é—­ä¹‹å‰å…³é—­è¿æ¥å¾ˆå®¹æ˜“ã€‚</p>

<p>æˆ‘å°†ä¸€æ®µä¸€æ®µåœ°å±•ç¤ºä»£ç ï¼Œä½†æ˜¯<a href="https://github.com/eliben/code-for-blog/blob/master/2020/tcp-server-shutdown/shutdown1/shutdown1.go">è¿™é‡Œ</a>æä¾›äº†å®Œæ•´çš„å¯è¿è¡Œä»£ç ç¤ºä¾‹ã€‚è®©æˆ‘ä»¬ä»æœåŠ¡å™¨ç±»å‹å’Œæ„é€ å‡½æ•°å¼€å§‹ï¼š</p>

<pre><code class="language-go">type Server struct {
  listener net.Listener
  quit     chan interface{}
  wg       sync.WaitGroup
}

func NewServer(addr string) *Server {
  s := &amp;Server{
    quit: make(chan interface{}),
  }
  l, err := net.Listen(&quot;tcp&quot;, addr)
  if err != nil {
    log.Fatal(err)
  }
  s.listener = l
  s.wg.Add(1)
  go s.serve()
  return s
}
</code></pre>

<p><code>NewServer</code>åˆ›å»ºä¸€ä¸ªæ–°çš„<code>Server</code>å®ä¾‹ï¼Œè¯¥æœåŠ¡å™¨åœ¨åå°goroutineä¸­ä¾¦å¬æ–°è¿æ¥ã€‚é™¤äº†<code>net.Listener</code>ä¹‹å¤–ï¼Œ<code>Server</code>ç»“æ„è¿˜åŒ…å«ä¸€ä¸ªç”¨äºå‘å‡ºå…³é—­ä¿¡å·çš„é€šé“å’Œä¸€ä¸ªç­‰å¾…ç»„ï¼Œç­‰å¾…æœåŠ¡å™¨çš„æ‰€æœ‰goroutineå®é™…å®Œæˆã€‚</p>

<p>ä»¥ä¸‹æ˜¯æ„é€ å‡½æ•°è°ƒç”¨çš„æœåŠ¡æ–¹æ³•ï¼š</p>

<pre><code class="language-go">func (s *Server) serve() {
  defer s.wg.Done()

  for {
    conn, err := s.listener.Accept()
    if err != nil {
      select {
      case &lt;-s.quit:
        return
      default:
        log.Println(&quot;accept error&quot;, err)
      }
    } else {
      s.wg.Add(1)
      go func() {
        s.handleConection(conn)
        s.wg.Done()
      }()
    }
  }
}
</code></pre>

<p>è¿™æ˜¯ä¸€ä¸ªæ ‡å‡†çš„<code>Accept</code>å¾ªç¯ï¼Œé™¤äº†<code>select</code>ã€‚æ­¤<code>select</code>æ‰€åšçš„æ˜¯åœ¨æ¥å—é”™è¯¯è¾“å‡ºæ—¶æ£€æŸ¥ï¼ˆä»¥éé˜»å¡æ–¹å¼ï¼‰<code>s.quit</code>é€šé“ä¸Šæ˜¯å¦å­˜åœ¨äº‹ä»¶ï¼ˆä¾‹å¦‚å‘é€æˆ–å…³é—­ï¼‰ã€‚å¦‚æœæœ‰ï¼Œåˆ™æ„å‘³ç€é”™è¯¯æ˜¯ç”±æˆ‘ä»¬å…³é—­ä¾¦å¬å™¨å¼•èµ·çš„ï¼Œå¹¶ä¸”<code>æœåŠ¡</code>å°†å®‰é™åœ°è¿”å›ã€‚å¦‚æœ<code>Accept</code>è¿”å›æ—¶æ²¡æœ‰é”™è¯¯ï¼Œåˆ™è¿è¡Œè¿æ¥å¤„ç†ç¨‹åº[1]ã€‚</p>

<p>ä¸‹é¢æ˜¯å‘Šè¯‰æœåŠ¡å™¨æ­£å¸¸å…³é—­çš„<code>Stop</code>æ–¹æ³•ï¼š</p>

<pre><code class="language-go">func (s *Server) Stop() {
  close(s.quit)
  s.listener.Close()
  s.wg.Wait()
}
</code></pre>

<p>é¦–å…ˆå…³é—­<code>s.quité€šé“</code>ã€‚ç„¶åå®ƒå…³é—­ç›‘å¬å™¨ã€‚è¿™å°†å¯¼è‡´æœåŠ¡ä¸­çš„<code>Accept</code>è°ƒç”¨è¿”å›é”™è¯¯ã€‚ç”±äº<code>s.quit</code>æ­¤æ—¶å·²å…³é—­ï¼ŒæœåŠ¡å°†è¿”å›ï¼Œä¸å†å¤„ç†ã€‚</p>

<p><code>Stop</code>æ–¹æ³•çš„æœ€åä¸€è¡Œæ˜¯åœ¨<code>s.wg</code>ï¼Œè¿™ä¹Ÿæ˜¯å…³é”®ã€‚æ³¨æ„ï¼Œ<code>serve</code>é€šçŸ¥ç­‰å¾…ç»„å®ƒåœ¨è¿”å›æ—¶å®Œæˆã€‚ä½†è¿™ä¸æ˜¯æˆ‘ä»¬ç­‰å¾…çš„å”¯ä¸€ä¸€æ¬¡ã€‚å¯¹<code>handleConnection</code>çš„æ¯ä¸ªè°ƒç”¨ä¹Ÿç”±<code>wg</code> add/doneåŒ…è£…ã€‚å› æ­¤ï¼Œ<code>Stop</code>å°†é˜»å¡ç›´åˆ°æ‰€æœ‰å¤„ç†ç¨‹åºéƒ½è¿”å›ï¼Œè€Œ<code>serve</code>å°†åœæ­¢æ¥å—æ–°è¿æ¥ã€‚è¿™æ˜¯ä¸€ä¸ªå®‰å…¨çš„å…³é—­ç‚¹ã€‚</p>

<p>ä¸ºäº†å®Œæ•´èµ·è§ï¼Œè¿™é‡Œæ˜¯<code>handleConnection</code>ï¼›è¿™é‡Œçš„<code>handleConnection</code>åªè¯»å–å®¢æˆ·ç«¯æ•°æ®å¹¶å°†å…¶è®°å½•ä¸‹æ¥ï¼Œè€Œä¸å‘é€ä»»ä½•æ•°æ®ã€‚å½“ç„¶ï¼Œè¿™éƒ¨åˆ†ä»£ç å¯¹äºæ¯ä¸ªæœåŠ¡å™¨éƒ½æ˜¯ä¸åŒçš„ï¼š</p>

<pre><code class="language-go">func (s *Server) handleConection(conn net.Conn) {
  defer conn.Close()
  buf := make([]byte, 2048)
  for {
    n, err := conn.Read(buf)
    if err != nil &amp;&amp; err != io.EOF {
      log.Println(&quot;read error&quot;, err)
      return
    }
    if n == 0 {
      return
    }
    log.Printf(&quot;received from %v: %s&quot;, conn.RemoteAddr(), string(buf[:n]))
  }
}
</code></pre>

<p>ä½¿ç”¨æ­¤æœåŠ¡å™¨å¾ˆç®€å•ï¼š</p>

<pre><code class="language-go">s := NewServer(addr)
// do whatever here...
s.Stop()
</code></pre>

<p>å›æƒ³ä¸€ä¸‹ï¼Œ<code>NewServer</code>è¿”å›ä¸€ä¸ªæœåŠ¡å™¨ï¼Œä½†ä¸é˜»å¡ã€‚<code>s.Stop</code>ç¡®å®ä¼šé˜»å¡ã€‚åœ¨æµ‹è¯•ä¸­ï¼Œæ‚¨è¦åšçš„æ˜¯ï¼š</p>

<ol>
<li>ç¡®ä¿ä¸æœåŠ¡å™¨äº¤äº’çš„æ‰€æœ‰å®¢æˆ·ç«¯éƒ½å·²å…³é—­å…¶è¿æ¥ã€‚</li>
<li>ç­‰å¾…s.Stopã€‚</li>
</ol>

<h2>æ­¥éª¤2ï¼šä¸»åŠ¨å…³é—­æ‰“å¼€çš„å®¢æˆ·ç«¯è¿æ¥</h2>

<p>åœ¨æ­¥éª¤1ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›æ‰€æœ‰å®¢æˆ·ç«¯åœ¨å£°æ˜å…³é—­è¿›ç¨‹æˆåŠŸä¹‹å‰å…³é—­å…¶è¿æ¥ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†çœ‹åˆ°ä¸€ç§æ›´æ¿€è¿›çš„æ–¹æ³•ï¼Œåœ¨<code>Stop()</code>ä¸­ï¼ŒæœåŠ¡å™¨å°†ä¸»åŠ¨å°è¯•å…³é—­æ‰“å¼€çš„å®¢æˆ·ç«¯è¿æ¥ã€‚é¦–å…ˆï¼Œæˆ‘å°†ä»‹ç»ä¸€ç§æ—¢ç®€å•åˆå¥å£®çš„æŠ€æœ¯ï¼Œä»¥ç‰ºç‰²ä¸€äº›æ€§èƒ½ä¸ºä»£ä»·ã€‚ä¹‹åï¼Œæˆ‘ä»¬å°†è®¨è®ºä¸€äº›æ›¿ä»£æ–¹æ¡ˆã€‚</p>

<p>æ­¤æ­¥éª¤çš„<a href="https://github.com/eliben/code-for-blog/blob/master/2020/tcp-server-shutdown/shutdown2/shutdown2.go">å®Œæ•´ä»£ç </a>ã€‚ä¸æ­¥éª¤1ç›¸åŒï¼Œåªæ˜¯<code>handleConection</code>çš„ä»£ç ï¼š</p>

<pre><code class="language-go">func (s *Server) handleConection(conn net.Conn) {
  defer conn.Close()
  buf := make([]byte, 2048)
ReadLoop:
  for {
    select {
    case &lt;-s.quit:
      return
    default:
      conn.SetDeadline(time.Now().Add(200 * time.Millisecond))
      n, err := conn.Read(buf)
      if err != nil {
        if opErr, ok := err.(*net.OpError); ok &amp;&amp; opErr.Timeout() {
          continue ReadLoop
        } else if err != io.EOF {
          log.Println(&quot;read error&quot;, err)
          return
        }
      }
      if n == 0 {
        return
      }
      log.Printf(&quot;received from %v: %s&quot;, conn.RemoteAddr(), string(buf[:n]))
    }
  }
}
</code></pre>

<p>æ­¤å¤„ç†ç¨‹åºä¸ºæ¯ä¸ªå¥—æ¥å­—è¯»å–è®¾ç½®ä¸€ä¸ªæˆªæ­¢æ—¥æœŸã€‚è¿™é‡Œçš„æˆªæ­¢æ—¶é—´æ˜¯200æ¯«ç§’ï¼Œä½†å¯ä»¥è®¾ç½®ä¸ºå¯¹æ‚¨çš„ç‰¹å®šåº”ç”¨ç¨‹åºæœ‰æ„ä¹‰çš„ä»»ä½•å…¶ä»–æ—¶é—´ã€‚å¦‚æœè¯»å–è¿”å›è¶…æ—¶ï¼Œåˆ™è¡¨ç¤ºå®¢æˆ·ç«¯åœ¨è¶…æ—¶æœŸé—´å¤„äºç©ºé—²çŠ¶æ€ï¼Œè¿æ¥å¯ä»¥å®‰å…¨å…³é—­ã€‚æ‰€ä»¥å¾ªç¯çš„æ¯æ¬¡è¿­ä»£éƒ½ä¼šæ£€æŸ¥<code>s.quit</code>å¹¶è¿”å›æ˜¯å¦å­˜åœ¨äº‹ä»¶ã€‚</p>

<p>è¿™ç§æ–¹æ³•æ˜¯å¥å£®çš„ï¼Œå› ä¸ºæˆ‘ä»¬ï¼ˆå¾ˆå¯èƒ½ï¼‰ä¸ä¼šåœ¨å®¢æˆ·ç«¯ä¸»åŠ¨å‘é€æ¶ˆæ¯æ—¶å…³é—­è¿æ¥ã€‚å®ƒä¹Ÿå¾ˆç®€å•ï¼Œå› ä¸ºå®ƒå°†æ‰€æœ‰é¢å¤–çš„é€»è¾‘é™åˆ¶ä¸º<code>handleConnection</code>ã€‚</p>

<p>å½“ç„¶ï¼Œè¿™é‡Œè¿˜æœ‰ä¸€äº›æ€§èƒ½æŸè€—ã€‚é¦–å…ˆï¼Œæ¯200æ¯«ç§’å‘å‡ºä¸€æ¬¡<code>conn.Read</code>è°ƒç”¨ï¼Œè¿™æ¯”å•ä¸ªé˜»å¡è°ƒç”¨ç¨æ…¢ï¼›ä¸è¿‡ï¼Œæˆ‘è®¤ä¸ºè¿™å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚æ›´ä¸¥é‡çš„æ˜¯ï¼Œæ¯ä¸€ä¸ª<code>Stop</code>è¯·æ±‚éƒ½ä¼šå»¶è¿Ÿ200æ¯«ç§’ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å…³é—­æœåŠ¡å™¨ï¼Œè¿™å¯èƒ½æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯å¯ä»¥æ ¹æ®ç‰¹å®šçš„åè®®éœ€è¦è°ƒæ•´æˆªæ­¢æ—¶é—´ã€‚</p>

<p>è¿™ç§è®¾è®¡çš„å¦ä¸€ç§æ–¹æ³•æ˜¯è·Ÿè¸ª<code>handleconaction</code>å¤–éƒ¨æ‰€æœ‰æ‰“å¼€çš„è¿æ¥ï¼Œå¹¶åœ¨è°ƒç”¨<code>Stop</code>æ—¶å¼ºåˆ¶å…³é—­å®ƒä»¬ã€‚è¿™å°†å¯èƒ½æ˜¯æ›´é«˜æ•ˆçš„ï¼Œä»¥å®ç°å¤æ‚æ€§å’Œä¸€äº›ç¼ºä¹é²æ£’æ€§ä¸ºä»£ä»·ã€‚è¿™æ ·çš„<code>Stop</code>å¾ˆå®¹æ˜“åœ¨å®¢æˆ·ç«¯ä¸»åŠ¨å‘é€æ•°æ®æ—¶å…³é—­è¿æ¥ï¼Œä»è€Œå¯¼è‡´å®¢æˆ·ç«¯é”™è¯¯ã€‚</p>

<p>ä¸ºäº†è·å¾—æ­£ç¡®è·¯å¾„ä¸Šçš„çµæ„Ÿï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹æ ‡å‡†åº“çš„<code>http.Server.Shutdown</code>æ–¹æ³•ï¼Œå…¶æ–‡æ¡£å¦‚ä¸‹ï¼š</p>

<blockquote>
<p>Shutdown gracefully shuts down the server without interrupting any active connections. Shutdown works by first closing all open listeners, then closing all idle connections, and then waiting indefinitely for connections to return to idle and then shut down</p>
</blockquote>

<p>â€œidleâ€åœ¨è¿™é‡Œæ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿå¤§è‡´ä¸Šï¼Œå®¢æˆ·ç«¯å·²ç»æœ‰ä¸€æ®µæ—¶é—´æ²¡æœ‰å‘é€ä»»ä½•è¯·æ±‚äº†ã€‚HTTPæœåŠ¡å™¨æ¯”ä¸€èˆ¬çš„TCPæœåŠ¡å™¨æœ‰ä¼˜åŠ¿ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªæ›´é«˜çº§åˆ«çš„åè®®ï¼Œæ‰€ä»¥å®ƒçŸ¥é“å®¢æˆ·ç«¯é€šä¿¡æ¨¡å¼ã€‚åœ¨ä¸åŒçš„åè®®ä¸­ï¼Œä¸åŒçš„å…³é—­ç­–ç•¥å¯èƒ½æ˜¯æœ‰æ„ä¹‰çš„ã€‚</p>

<p>å¦ä¸€ä¸ªä¾‹å­æ˜¯æœåŠ¡ç«¯å‘èµ·æ¶ˆæ¯çš„åè®®ï¼Œæˆ–è€…è‡³å°‘å…¶ä¸­ä¸€äº›æ¶ˆæ¯ã€‚ä¾‹å¦‚ï¼Œç»™å®šçš„è¿æ¥å¯èƒ½å¤„äºå®¢æˆ·ç«¯ç­‰å¾…æœåŠ¡å™¨å‘é€æŸä¸ªäº‹ä»¶çš„çŠ¶æ€ã€‚æœåŠ¡ç«¯å…³é—­æ­¤è¿æ¥é€šå¸¸æ˜¯å®‰å…¨çš„ï¼Œæ— éœ€ç­‰å¾…ä»»ä½•ä¸œè¥¿ã€‚</p>

<h2>ç»“è®º</h2>

<p>æˆ‘å°†ç”¨ä¸¤ä¸ªä¸€èˆ¬å‡†åˆ™æ¥æ€»ç»“è¿™ç¯‡æ–‡ç« ï¼š</p>

<ol>
<li>å°½å¯èƒ½å®‰å…¨åœ°å…³é—­</li>
<li>è€ƒè™‘æ›´é«˜å±‚æ¬¡çš„åè®®</li>
</ol>

<p>æˆ‘é€šå¸¸åœ¨ç¼–å†™æµ‹è¯•æ—¶é‡åˆ°å…³é—­TCPæœåŠ¡å™¨çš„éœ€è¦ã€‚æˆ‘å¸Œæœ›æ¯ä¸ªæµ‹è¯•éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œå¹¶åœ¨æµ‹è¯•å®Œæˆåè¿›è¡Œæ¸…ç†ï¼ŒåŒ…æ‹¬æ‰€æœ‰çš„å®¢æˆ·ç«¯-æœåŠ¡å™¨è¿æ¥å’Œç›‘å¬æœåŠ¡å™¨ã€‚å¯¹äºè¿™ä¸ªåœºæ™¯ï¼Œæ­¥éª¤1éå¸¸æœ‰æ•ˆã€‚å…³é—­æ‰€æœ‰å®¢æˆ·ç«¯è¿æ¥åï¼Œ<code>Server.Stop</code>å°†ç«‹å³è¿”å›ã€‚</p>

<p>[^1]: æ³¨æ„ä½¿ç”¨WaitGroupçš„æ¨¡å¼ï¼šwg.Add(1)æ˜¯åœ¨goè¯­å¥å¯åŠ¨goroutineä¹‹å‰è°ƒç”¨çš„ã€‚è¿™æ˜¯åœ¨å¯åŠ¨go s.serve()ä¹‹å‰åœ¨æ„é€ å‡½æ•°ä¸­å®Œæˆçš„ã€‚è¿™ç§æ–¹å¼å¯¹å®‰å…¨å¾ˆé‡è¦ã€‚å¦‚æœæˆ‘ä»¬åœ¨goroutineå†…éƒ¨è°ƒç”¨wg.Add(1)ï¼Œåœ¨goroutineæœ‰æœºä¼šè¿è¡Œä¹‹å‰è°ƒç”¨wg.Wait()çš„æ‰§è¡Œåºåˆ—å¯èƒ½ä¼šå‘ç”Ÿï¼›å› ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒWaitç»„ä¸­å°šæœªæ·»åŠ ä»»ä½•å†…å®¹ï¼ŒWaitå°†è¿”å›ï¼›è¿™æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚</p>

                    </div>
                    <footer class="article-footer">
                      <a href="https://qichengzx.github.io/2020/02/02/graceful-shutdown-of-a-tcp-server-in-go.html#comments" class="article-comment-link">Comments</a>
                      
                        <ul class="article-tag-list">
                        
                          <li class="article-tag-list-item">
                            <a class="article-tag-list-link" href="/tags/go">go</a>
                          </li>
                        
                        </ul>
                      
                    </footer>
                  </div>
                  <nav id="article-nav">
                    

                    
                  </nav>
                </article>

        
        
                <article id="3cf71223f82a73e481f1528acdfcc6f7" class="article" itemscope itemprop="blogPost">
                  <div class="article-meta">
                    <a href="https://qichengzx.github.io/2019/01/01/go-in-the-browser.html" class="article-date">
                      <time itemprop="datePublished">2019-01-01 15:53:01</time>
                    </a>
                    <div class="article-category">
                      <a class="article-category-link" href="/categories/golang">golang</a>
                    </div>
                  </div>
                  <div class="article-inner">
                    <header class="article-header">
                      <h1 itemprop="name">
                        <a class="article-title" href="https://qichengzx.github.io/2019/01/01/go-in-the-browser.html">ã€è¯‘ã€‘Goå’ŒWebAssemblyï¼šåœ¨æµè§ˆå™¨ä¸­è¿è¡ŒGoç¨‹åº</a>
                      </h1>
                    </header>
                    <div class="article-entry" itemprop="articleBody">
                      <p>åœ¨è¿‡å»å¾ˆé•¿ä¸€æ®µæ—¶é—´é‡Œï¼ŒJavascriptæ˜¯Webå¼€å‘äººå‘˜ä¸­çš„é€šç”¨è¯­è¨€ã€‚å¦‚æœä½ æƒ³å†™ä¸€ä¸ªç¨³å®šæˆç†Ÿçš„ Web åº”ç”¨ç¨‹åºï¼Œç”¨javascriptå‡ ä¹æ˜¯å”¯ä¸€çš„æ–¹æ³•ã€‚</p>

<p>WebAssemblyï¼ˆä¹Ÿç§°ä¸ºwasmï¼‰å°†å¾ˆå¿«æ”¹å˜è¿™ç§æƒ…å†µã€‚ä½¿ç”¨WebAssemblyå¯ä»¥ç”¨ä»»ä½•è¯­è¨€ç¼–å†™Webåº”ç”¨ç¨‹åºã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•ç¼–å†™Goç¨‹åºå¹¶ä½¿ç”¨wasmåœ¨æµè§ˆå™¨ä¸­è¿è¡Œå®ƒä»¬ã€‚</p>

<h2>ä½†é¦–å…ˆï¼Œä»€ä¹ˆæ˜¯WebAssembly</h2>

<p><a href="https://webassembly.org/">webassembly.org</a> å°†å…¶å®šä¹‰ä¸ºâ€œåŸºäºå †æ ˆçš„è™šæ‹Ÿæœºçš„äºŒè¿›åˆ¶æŒ‡ä»¤æ ¼å¼â€ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å®šä¹‰ï¼Œä½†è®©æˆ‘ä»¬å°†å…¶åˆ†è§£ä¸ºæˆ‘ä»¬å¯ä»¥è½»æ¾ç†è§£çš„å†…å®¹ã€‚</p>

<p>ä»æœ¬è´¨ä¸Šè®²ï¼Œwasmæ˜¯ä¸€ç§äºŒè¿›åˆ¶æ ¼å¼; å°±åƒELFï¼ŒMachå’ŒPEä¸€æ ·ã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯å®ƒé€‚ç”¨äºè™šæ‹Ÿç¼–è¯‘ç›®æ ‡ï¼Œè€Œä¸æ˜¯å®é™…çš„ç‰©ç†æœºå™¨ã€‚ä¸ºä½•è™šæ‹Ÿï¼Ÿå› ä¸ºä¸åŒäº C/C++ äºŒè¿›åˆ¶æ–‡ä»¶ï¼ŒwasmäºŒè¿›åˆ¶æ–‡ä»¶ä¸é’ˆå¯¹ç‰¹å®šå¹³å°ã€‚å› æ­¤ï¼Œæ‚¨å¯ä»¥åœ¨Linuxï¼ŒWindowså’ŒMacä¸­ä½¿ç”¨ç›¸åŒçš„äºŒè¿›åˆ¶æ–‡ä»¶è€Œæ— éœ€è¿›è¡Œä»»ä½•æ›´æ”¹ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å¦ä¸€ä¸ªâ€œä»£ç†â€ï¼Œå®ƒå°†äºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„wasmæŒ‡ä»¤è½¬æ¢ä¸ºç‰¹å®šäºå¹³å°çš„æŒ‡ä»¤å¹¶è¿è¡Œå®ƒä»¬ã€‚é€šå¸¸ï¼Œè¿™ä¸ªâ€œä»£ç†â€æ˜¯ä¸€ä¸ªæµè§ˆå™¨ï¼Œä½†ä»ç†è®ºä¸Šè®²ï¼Œå®ƒä¹Ÿå¯ä»¥æ˜¯å…¶ä»–ä»»ä½•ä¸œè¥¿ã€‚</p>

<p>è¿™ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªé€šç”¨çš„ç¼–è¯‘ç›®æ ‡ï¼Œå¯ä»¥ä½¿ç”¨æˆ‘ä»¬é€‰æ‹©çš„ä»»ä½•ç¼–ç¨‹è¯­è¨€æ„å»ºWebåº”ç”¨ç¨‹åºï¼åªè¦æˆ‘ä»¬ç¼–è¯‘ä¸ºwasmæ ¼å¼ï¼Œæˆ‘ä»¬å°±ä¸å¿…æ‹…å¿ƒç›®æ ‡å¹³å°ã€‚å°±åƒæˆ‘ä»¬ç¼–å†™ä¸€ä¸ªWebåº”ç”¨ç¨‹åºä¸€æ ·ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬æœ‰äº†ç”¨æˆ‘ä»¬é€‰æ‹©çš„ä»»ä½•è¯­è¨€ç¼–å†™å®ƒçš„ä¼˜åŠ¿ã€‚</p>

<h2>ä½ å¥½ WASM</h2>

<p>è®©æˆ‘ä»¬ä»ä¸€ä¸ªç®€å•çš„â€œhello worldâ€ç¨‹åºå¼€å§‹ï¼Œä½†æ˜¯è¦ç¡®ä¿æ‚¨çš„Goç‰ˆæœ¬è‡³å°‘ä¸º1.11ã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼š</p>

<pre><code class="language-go">package main

import (
	&quot;fmt&quot;
)

func main() {
	fmt.Println(&quot;hello wasm&quot;)
}
</code></pre>

<p>ä¿å­˜ä¸º<code>test.go</code>ã€‚çœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ªæ™®é€šçš„Goç¨‹åºã€‚ç°åœ¨è®©æˆ‘ä»¬å°†å®ƒç¼–è¯‘ä¸ºwasmå¹³å°ç¨‹åºã€‚æˆ‘ä»¬éœ€è¦è®¾ç½®<code>GOOS</code>å’Œ<code>GOARCH</code>ã€‚</p>

<pre><code class="language-go">$GOOS=js GOARCH=wasm go build -o test.wasm test.go
</code></pre>

<p>ç°åœ¨æˆ‘ä»¬ç”Ÿæˆäº† wasm äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ä½†ä¸åŸç”Ÿç³»ç»Ÿä¸åŒï¼Œæˆ‘ä»¬éœ€è¦åœ¨æµè§ˆå™¨ä¸­è¿è¡Œå®ƒã€‚ä¸ºæ­¤ï¼Œè¿˜éœ€è¦å†åšä¸€ç‚¹å·¥ä½œæ¥å®ç°è¿™ä¸€ç›®æ ‡ï¼š</p>

<ul>
<li>WebæœåŠ¡å™¨æ¥è¿è¡Œåº”ç”¨</li>
<li>ä¸€ä¸ªindex.htmlæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«åŠ è½½wasmäºŒè¿›åˆ¶æ–‡ä»¶æ‰€éœ€çš„ä¸€äº›jsä»£ç ã€‚</li>
<li>è¿˜æœ‰ä¸€ä¸ªjsæ–‡ä»¶ï¼Œå®ƒä½œä¸ºæµè§ˆå™¨å’Œæˆ‘ä»¬çš„wasmäºŒè¿›åˆ¶æ–‡ä»¶ä¹‹é—´çš„é€šä¿¡æ¥å£ã€‚</li>
</ul>

<p>æˆ‘å–œæ¬¢æŠŠå®ƒæƒ³è±¡æˆåˆ¶ä½œThe PowerPuff Girlsæ‰€éœ€è¦çš„ä¸œè¥¿ã€‚</p>

<p><img src="/images/go/powerpuff.jpg" alt="" /></p>

<p>ç„¶åï¼ŒBOOMï¼Œæˆ‘ä»¬æœ‰äº†ä¸€ä¸ªWebAssemblyåº”ç”¨ç¨‹åºï¼</p>

<p>ç°åœ¨Goç›®å½•ä¸­å·²ç»åŒ…å«äº†htmlå’Œjsæ–‡ä»¶ï¼Œå› æ­¤æˆ‘ä»¬å°†å…¶å¤åˆ¶è¿‡æ¥ã€‚</p>

<pre><code class="language-shell">$cp &quot;$(go env GOROOT)/misc/wasm/wasm_exec.js&quot; .
$cp &quot;$(go env GOROOT)/misc/wasm/wasm_exec.html&quot; .
$# we rename the html file to index.html for convenience.
$mv wasm_exec.html index.html
$ls -l
total 8960
-rw-r--r-- 1 agniva agniva    1258 Dec  6 12:16 index.html
-rwxrwxr-x 1 agniva agniva 6721905 Sep 24 12:28 serve
-rw-rw-r-- 1 agniva agniva      76 Dec  6 12:08 test.go
-rwxrwxr-x 1 agniva agniva 2425246 Dec  6 12:09 test.wasm
-rw-r--r-- 1 agniva agniva   11905 Dec  6 12:16 wasm_exec.js
</code></pre>

<p><code>serve</code>æ˜¯GoäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ˜¯ä¸€ä¸ªWebæœåŠ¡å™¨ã€‚ä½†å‡ ä¹ä»»ä½•WebæœåŠ¡å™¨éƒ½å¯ä»¥ã€‚ï¼ˆè¯‘è€…æ³¨:åŸæ–‡å¹¶æ²¡æœ‰æä¾›serveäºŒè¿›åˆ¶æ–‡ä»¶çš„æºä»£ç ï¼Œç›¸ä¿¡èªæ˜çš„ä½ ä¸€å®šçŸ¥é“æ€æ ·ç¼–å†™ã€‚ï¼‰</p>

<p>ä¸€æ—¦è¿è¡Œå®ƒï¼Œå¹¶æ‰“å¼€æµè§ˆå™¨ã€‚å¯ä»¥çœ‹åˆ°ä¸€ä¸ª<code>Run</code>æŒ‰é’®ï¼Œç‚¹å‡»å®ƒï¼Œå°†æ‰§è¡Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚ç„¶åæˆ‘ä»¬ç‚¹å‡»å®ƒå¹¶æ£€æŸ¥æ§åˆ¶å°ï¼š</p>

<p><img src="/images/go/hellowasm.png" alt="" /></p>

<p>çœŸç‰›ï¼Œæˆ‘ä»¬åˆšåˆšåœ¨Goä¸­ç¼–å†™äº†ä¸€ä¸ªç¨‹åºå¹¶åœ¨æµè§ˆå™¨ä¸­è¿è¡Œå®ƒã€‚</p>

<p>åˆ°ç°åœ¨ä¸ºæ­¢ä¸€åˆ‡é¡ºåˆ©ã€‚ä½†è¿™æ˜¯ä¸€ä¸ªç®€å•çš„â€œhello worldâ€ç¨‹åºã€‚çœŸå®çš„Webåº”ç”¨ç¨‹åºéœ€è¦ä¸DOMäº¤äº’ã€‚æˆ‘ä»¬éœ€è¦å“åº”æŒ‰é’®å•å‡»äº‹ä»¶ï¼Œä»æ–‡æœ¬æ¡†ä¸­è·å–è¾“å…¥æ•°æ®ï¼Œå¹¶å°†æ•°æ®å‘é€å›DOMã€‚ç°åœ¨æˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªæœ€å°çš„å›¾åƒç¼–è¾‘å™¨ï¼Œå®ƒå°†ä½¿ç”¨æ‰€æœ‰è¿™äº›åŠŸèƒ½ã€‚</p>

<h2>DOM API</h2>

<p>ä½†é¦–å…ˆï¼Œè¦ä½¿Goä»£ç ä¸æµè§ˆå™¨è¿›è¡Œäº¤äº’ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªDOM APIã€‚æˆ‘ä»¬æœ‰<code>syscall/js</code>åº“æ¥å¸®åŠ©æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å®ƒæ˜¯ä¸€ä¸ªéå¸¸ç®€å•å´åŠŸèƒ½å¼ºå¤§çš„DOM APIå½¢å¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸Šæ„å»ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚åœ¨æˆ‘ä»¬åˆ¶ä½œåº”ç”¨ç¨‹åºä¹‹å‰ï¼Œè®©æˆ‘ä»¬å¿«é€Ÿäº†è§£å®ƒçš„ä¸€äº›åŠŸèƒ½ã€‚</p>

<h3>å›è°ƒ</h3>

<p>ä¸ºäº†å“åº”DOMäº‹ä»¶ï¼Œæˆ‘ä»¬å£°æ˜äº†å›è°ƒå¹¶ç”¨è¿™æ ·çš„äº‹ä»¶å°†å®ƒä»¬è¿æ¥èµ·æ¥ï¼š</p>

<pre><code class="language-go">import &quot;syscall/js&quot;

// Declare callback
cb := js.NewEventCallback(js.PreventDefault, func(ev js.Value) {
	// handle event
})


// Hook it up with a DOM event
js.Global().Get(&quot;document&quot;).
	Call(&quot;getElementById&quot;, &quot;myBtn&quot;).
	Call(&quot;addEventListener&quot;, &quot;click&quot;, cb)


// Call cb.Release() on your way out.
</code></pre>

<h3>æ›´æ–°DOM</h3>

<p>è¦ä»Goä¸­æ›´æ–°DOMï¼Œæˆ‘ä»¬å¯ä»¥</p>

<pre><code class="language-go">import &quot;syscall/js&quot;

js.Global().Get(&quot;document&quot;).
		Call(&quot;getElementById&quot;, &quot;myTextBox&quot;).
		Set(&quot;value&quot;, &quot;hello wasm&quot;)
</code></pre>

<p>æ‚¨ç”šè‡³å¯ä»¥è°ƒç”¨JSå‡½æ•°å¹¶æ“ä½œæœ¬æœºJSå¯¹è±¡ï¼Œå¦‚ <code>FileReader</code>æˆ–<code>Canvas</code>ã€‚æŸ¥çœ‹<a href="https://golang.org/pkg/syscall/js/"><code>syscall/js</code></a>æ–‡æ¡£ä»¥è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚</p>

<h2>æ­£ç¡®çš„ Web åº”ç”¨ç¨‹åº</h2>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªå°åº”ç”¨ç¨‹åºï¼Œå®ƒå°†è·å–è¾“å…¥çš„å›¾åƒï¼Œç„¶åå¯¹å›¾åƒæ‰§è¡Œä¸€äº›æ“ä½œï¼Œå¦‚äº®åº¦ï¼Œå¯¹æ¯”åº¦ï¼Œè‰²è°ƒï¼Œé¥±å’Œåº¦ï¼Œæœ€åå°†è¾“å‡ºå›¾åƒå‘é€å›æµè§ˆå™¨ã€‚ æ¯ä¸ªæ•ˆæœéƒ½ä¼šæœ‰æ»‘å—ï¼Œç”¨æˆ·å¯ä»¥æ›´æ”¹è¿™äº›æ•ˆæœå¹¶å®æ—¶æŸ¥çœ‹ç›®æ ‡å›¾åƒçš„å˜åŒ–ã€‚</p>

<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä»æµè§ˆå™¨è·å–è¾“å…¥çš„å›¾åƒç»™åˆ°æˆ‘ä»¬çš„Goä»£ç ï¼Œä»¥ä¾¿å¯ä»¥å¤„ç†å®ƒã€‚ä¸ºäº†æœ‰æ•ˆåœ°åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦é‡‡å–ä¸€äº›<code>ä¸å®‰å…¨</code>çš„æŠ€å·§ï¼Œè¿™é‡Œè·³è¿‡å…·ä½“ç»†èŠ‚ã€‚æ‹¥æœ‰å›¾åƒåï¼Œå®ƒå®Œå…¨åœ¨æˆ‘ä»¬çš„æ§åˆ¶ä¹‹ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªç”±åœ°åšä»»ä½•äº‹æƒ…ã€‚ä¸‹é¢æ˜¯å›¾åƒåŠ è½½å™¨å›è°ƒçš„ç®€çŸ­ç‰‡æ®µï¼Œä¸ºç®€æ´èµ·è§ç•¥æœ‰ç®€åŒ–ï¼š</p>

<pre><code class="language-go">onImgLoadCb = js.NewCallback(func(args []js.Value) {
	reader := bytes.NewReader(inBuf) // inBuf is a []uint8 slice where our image is loaded
	sourceImg, _, err := image.Decode(reader)
	if err != nil {
		// handle error
	}
	// Now the sourceImg is an image.Image with which we are free to do anything!
})

js.Global().Set(&quot;loadImage&quot;, onImgLoadCb)
</code></pre>

<p>ç„¶åæˆ‘ä»¬ä»æ•ˆæœæ»‘å—ä¸­è·å–ç”¨æˆ·å€¼ï¼Œå¹¶æ“çºµå›¾åƒã€‚æˆ‘ä»¬ä½¿ç”¨äº†å¾ˆæ£’çš„<a href="https://github.com/anthonynsimon/bild"><code>bild</code></a>åº“ã€‚ä¸‹é¢æ˜¯å›è°ƒçš„ä¸€å°éƒ¨åˆ†ï¼š</p>

<pre><code class="language-go">import &quot;github.com/anthonynsimon/bild/adjust&quot;

contrastCb = js.NewEventCallback(js.PreventDefault, func(ev js.Value) {
	delta := ev.Get(&quot;target&quot;).Get(&quot;valueAsNumber&quot;).Float()
	res := adjust.Contrast(sourceImg, delta)
})

js.Global().Get(&quot;document&quot;).
		Call(&quot;getElementById&quot;, &quot;contrast&quot;).
		Call(&quot;addEventListener&quot;, &quot;change&quot;, contrastCb)
</code></pre>

<p>åœ¨æ­¤ä¹‹åï¼Œæˆ‘ä»¬å°†ç›®æ ‡å›¾åƒç¼–ç ä¸ºjpegå¹¶å°†å…¶å‘é€å›æµè§ˆå™¨ã€‚è¿™æ˜¯å®Œæ•´çš„åº”ç”¨ç¨‹åºï¼š</p>

<p>åŠ è½½å›¾ç‰‡ï¼š</p>

<p><img src="/images/go/initial.png" alt="" /></p>

<p>æ”¹å˜å¯¹æ¯”ï¼š</p>

<p><img src="/images/go/contrast.png" alt="" /></p>

<p>æ”¹å˜è‰²è°ƒï¼š</p>

<p><img src="/images/go/hue.png" alt="" /></p>

<p>å¤ªæ£’äº†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æµè§ˆå™¨ä¸­æœ¬åœ°æ“ä½œå›¾åƒè€Œæ— éœ€ç¼–å†™ä¸€è¡ŒJavascriptï¼ æºä»£ç å¯ä»¥åœ¨<a href="https://github.com/agnivade/shimmer">è¿™é‡Œ</a>æ‰¾åˆ°ã€‚</p>

<p>è¯·æ³¨æ„ï¼Œæ‰€æœ‰è¿™äº›éƒ½æ˜¯åœ¨æµè§ˆå™¨æœ¬èº«ä¸­å®Œæˆçš„ã€‚è¿™é‡Œæ²¡æœ‰Flashæ’ä»¶ï¼ŒJava Appletæˆ–Silverlightã€‚è€Œæ˜¯ä½¿ç”¨æµè§ˆå™¨æœ¬èº«æ”¯æŒçš„å¼€ç®±å³ç”¨çš„WebAssemblyã€‚</p>

<h2>æœ€åçš„è¯</h2>

<p>æˆ‘çš„ä¸€äº›ç»“æŸè¯­ï¼š</p>

<ul>
<li><p>ç”±äºGoæ˜¯ä¸€ç§åƒåœ¾æ”¶é›†è¯­è¨€ï¼Œå› æ­¤æ•´ä¸ªè¿è¡Œæ—¶éƒ½åœ¨wasmäºŒè¿›åˆ¶æ–‡ä»¶ä¸­ã€‚å› æ­¤ï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶é€šå¸¸æœ‰å‡ MBçš„å¤§å°ã€‚ä¸C/Rustç­‰å…¶ä»–è¯­è¨€ç›¸æ¯”ï¼Œè¿™ä»ç„¶æ˜¯ä¸€ä¸ªç—›ç‚¹; å› ä¸ºå‘æµè§ˆå™¨å‘é€MBçº§æ•°æ®å¹¶ä¸ç†æƒ³ã€‚ä½†æ˜¯ï¼Œå¦‚æœwasmè§„èŒƒæœ¬èº«æ”¯æŒGCï¼Œé‚£ä¹ˆè¿™å¯èƒ½ä¼šæ”¹å˜ã€‚</p></li>

<li><p>Goä¸­çš„Wasmæ”¯æŒæ­£å¼è¿›è¡Œè¯•éªŒã€‚<code>syscall/js</code> APIæœ¬èº«ä¹Ÿåœ¨ä¸æ–­å˜åŒ–ï¼Œæœªæ¥å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚å¦‚æœæ‚¨å‘ç°é”™è¯¯ï¼Œè¯·éšæ—¶åœ¨æˆ‘ä»¬<a href="https://github.com/golang/go/issues">issues</a>æŠ¥å‘Šé—®é¢˜ã€‚</p></li>

<li><p>ä¸æ‰€æœ‰æŠ€æœ¯ä¸€æ ·ï¼ŒWebAssemblyä¹Ÿä¸æ˜¯ä¸€é¢—é“¶å¼¹ã€‚æœ‰æ—¶ï¼Œç®€å•çš„JSæ›´å¿«æ›´å®¹æ˜“ç¼–å†™ã€‚ç„¶è€Œï¼Œwasmè§„èŒƒæœ¬èº«æ­£åœ¨å¼€å‘ä¸­ï¼Œå¹¶ä¸”å³å°†æ¨å‡ºæ›´å¤šåŠŸèƒ½ã€‚çº¿ç¨‹æ”¯æŒå°±æ˜¯è¿™æ ·ä¸€ä¸ªç‰¹æ€§ã€‚</p></li>
</ul>

<p>å¸Œæœ›è¿™ç¯‡æ–‡ç« å±•ç¤ºäº†WebAssemblyçš„ä¸€äº›å¾ˆé…·çš„æ–¹é¢ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨Goç¼–å†™åŠŸèƒ½é½å…¨çš„Webåº”ç”¨ç¨‹åºã€‚å¦‚æœæ‚¨å‘ç°é”™è¯¯ï¼Œè¯·å°è¯•ä¸€ä¸‹ï¼Œå¹¶æå‡ºé—®é¢˜ã€‚å¦‚æœæ‚¨éœ€è¦ä»»ä½•å¸®åŠ©ï¼Œè¯·éšæ—¶è®¿é—® <a href="https://gophers.slack.com/">#webassembly</a>é¢‘é“ã€‚</p>

<h2>åŸæ–‡é“¾æ¥</h2>

<p><a href="https://blog.gopheracademy.com/advent-2018/go-in-the-browser/">Go and WebAssembly: running Go programs in your browser</a></p>

                    </div>
                    <footer class="article-footer">
                      <a href="https://qichengzx.github.io/2019/01/01/go-in-the-browser.html#comments" class="article-comment-link">Comments</a>
                      
                        <ul class="article-tag-list">
                        
                          <li class="article-tag-list-item">
                            <a class="article-tag-list-link" href="/tags/go">go</a>
                          </li>
                        
                        </ul>
                      
                    </footer>
                  </div>
                  <nav id="article-nav">
                    

                    
                  </nav>
                </article>

        
        
                <article id="df9d05c04e2f54ffe723724116eee302" class="article" itemscope itemprop="blogPost">
                  <div class="article-meta">
                    <a href="https://qichengzx.github.io/2018/06/15/qq-007-captcha.html" class="article-date">
                      <time itemprop="datePublished">2018-06-15 16:56:24</time>
                    </a>
                    <div class="article-category">
                      <a class="article-category-link" href="/categories/javascript">javascript</a>
                    </div>
                  </div>
                  <div class="article-inner">
                    <header class="article-header">
                      <h1 itemprop="name">
                        <a class="article-title" href="https://qichengzx.github.io/2018/06/15/qq-007-captcha.html">è…¾è®¯é˜²æ°´å¢™éªŒè¯ç ä½¿ç”¨</a>
                      </h1>
                    </header>
                    <div class="article-entry" itemprop="articleBody">
                      <p><img src="/images/WX20180615-172557.png" alt="" /></p>

<p>å‰é˜µå­è…¾è®¯å‡ºäº†ä¸ª<a href="https://007.qq.com/">éªŒè¯ç äº§å“</a>ï¼Œå®£ç§°â€œå‘Šåˆ«ä¼ ç»ŸéªŒè¯ç çš„å•ç‚¹é˜²å¾¡ï¼Œåé“å®‰å…¨æ …æ æ‰“é€ ç«‹ä½“å…¨é¢çš„å®‰å…¨éªŒè¯ï¼Œå°†é»‘äº§æ‹’ä¹‹é—¨å¤–â€ã€‚çœ‹èµ·æ¥å¾ˆä¸é”™çš„æ ·å­ï¼Œæ­£å¥½ä¹‹å‰ä½¿ç”¨è¿‡å¦å¤–ä¸€å®¶ç±»ä¼¼çš„äº§å“ï¼Œä½†æ˜¯å½“æ—¶æ²¡æœ‰è¯•ç”¨ï¼Œä»Šå¤©ç‰¹åœ°æ³¨å†Œäº†è§£äº†ä¸€ä¸‹ã€‚</p>

<p>æ³¨å†Œå¾ˆç®€å•ï¼Œå¡«å†™æ‰‹æœºå·é‚®ç®±å’ŒåŸŸåç­‰å³å¯ã€‚ç”±äºæ˜¯åœ¨æœ¬åœ°ç¯å¢ƒæµ‹è¯•ï¼Œä¼¼ä¹å¡«å†™çš„åŸŸåå¹¶æ²¡æœ‰ä»€ä¹ˆå½±å“ã€‚è€Œä¸”å¡«å†™æ—¶å¯ä»¥é€‰æ‹©é€‚ç”¨åœºæ™¯ï¼Œåº”è¯¥æ˜¯é’ˆå¯¹ä¸åŒçš„åœºæ™¯æœ‰ä¸åŒçš„ç­–ç•¥ã€‚</p>

<p>åŠŸèƒ½ä¹Ÿæ¯”è¾ƒä¸°å¯Œï¼Œæ”¯æŒï¼š</p>

<ul>
<li><p>2000æ¬¡/å°æ—¶å®‰å…¨é˜²æŠ¤</p></li>

<li><p>æ”¯æŒå…éªŒè¯+åˆ†çº§éªŒè¯</p></li>

<li><p>ä¸‰åˆ†é’Ÿå¿«é€Ÿæ¥å…¥</p></li>

<li><p>å…¨åŠŸèƒ½é…ç½®åå°</p></li>

<li><p>æ”¯æŒHTTPS</p></li>

<li><p>é˜ˆå€¼å†…æµé‡æ— å¹¿å‘Š</p></li>
</ul>

<p>æ³¨å†Œå®Œä¹‹åä¼šåˆ†é…ä¸€ä¸ª <code>appid</code> å’Œ <code>App Secret Key</code>ï¼Œ<code>App Secret Key</code> éœ€è¦å¦¥å–„ä¿å­˜ï¼Œä¸å¯æš´éœ²å‡ºæ¥ã€‚</p>

<p>ä¸‹é¢å°±ç®€å•çš„è®°å½•ä¸‹æ™®é€šåœºæ™¯ä¸‹å¦‚ä½•ä½¿ç”¨ã€‚ï¼ˆæ­¤åœºæ™¯æŒ‡ç®€å•ä½¿ç”¨ï¼ŒééªŒè¯ç é…ç½®çš„åœºæ™¯ï¼‰</p>

<h4>0.å‰ç«¯é¡µé¢</h4>

<p>åœ¨ HTML ä¸­å¼•å…¥jsæ–‡ä»¶ï¼š</p>

<pre><code class="language-html">&lt;script src=&quot;https://ssl.captcha.qq.com/TCaptcha.js&quot;&gt;&lt;/script&gt;
</code></pre>

<p>ç„¶ååœ¨éœ€è¦æ¿€æ´»çš„ä½ç½®åŠ å…¥ï¼š</p>

<pre><code class="language-html">&lt;button id=&quot;TencentCaptcha&quot;
  data-appid=&quot;200700xxxx&quot;
  data-cbfn=&quot;callback&quot;
&gt;éªŒè¯&lt;/button&gt;
</code></pre>

<p>å®˜æ–¹æ–‡æ¡£è¡¨ç¤ºå¯ä»¥ä½¿ç”¨å…¶ä»–æ ‡ç­¾ï¼Œåªéœ€æœ‰ <code>id</code> åŠ <code>cbfn</code> å±æ€§å³å¯ã€‚</p>

<p>ç„¶åæ³¨å†Œå›è°ƒå‡½æ•°ï¼š</p>

<pre><code class="language-javascript">window.callback = function(res){
  console.log(res)
  // resï¼ˆæœªé€šè¿‡éªŒè¯ï¼‰= {ret: 1, ticket: null}
  // resï¼ˆéªŒè¯æˆåŠŸï¼‰ = {ret: 0, ticket: &quot;String&quot;, randstr: &quot;String&quot;}
  if(res.ret === 0){
      alert(res.ticket)   // ç¥¨æ®
  }
}
</code></pre>

<p>å‰ç«¯çš„ callback å¦‚æœéªŒè¯æˆåŠŸåï¼Œå°±å¯ä»¥åœ¨æäº¤ä¿¡æ¯çš„åŒæ—¶æŠŠè…¾è®¯è¿”å›çš„å†…å®¹æäº¤ç»™åç«¯ï¼Œä¸»è¦æ˜¯éªŒè¯ç¥¨æ®ï¼š<code>ticket</code> å’Œéšæœºå­—ç¬¦ä¸²ï¼š<code>randstr</code>ã€‚</p>

<p>æˆ‘æµ‹è¯•çš„ä¾‹å­ä¸­æ˜¯è¿™æ ·çš„ï¼š</p>

<pre><code class="language-html">&lt;form action=&quot;/verify&quot; method=&quot;post&quot;&gt;
  &lt;input type=&quot;text&quot; name=&quot;appid&quot; value=&quot;200700xxxx&quot;/&gt;
  &lt;input type=&quot;text&quot; id=&quot;ticket&quot; name=&quot;ticket&quot;/&gt;
  &lt;input type=&quot;text&quot; id=&quot;randstr&quot; name=&quot;randstr&quot;/&gt;
  &lt;button id=&quot;btn&quot; disabled&gt;submit&lt;/button&gt;
&lt;/form&gt;
</code></pre>

<p>ä¿®æ”¹å›è°ƒå‡½æ•°ï¼š</p>

<pre><code class="language-javascript">window.callback = function(res){
  console.log(res)
  if(res.ret === 0){
    document.getElementById('ticket').value = res.ticket
    document.getElementById('randstr').value = res.randstr
    document.getElementById('ticket').value = res.ticket
    document.getElementById('btn').disabled = false
  } else {
    alert('éªŒè¯å¤±è´¥')
  }
}
</code></pre>

<p>å‰ç«¯éªŒè¯æˆåŠŸåï¼ŒæŠŠ <code>ticket</code> å’Œ <code>randstr</code> å¡«å……åˆ°è¡¨å•ä¸­å»ã€‚</p>

<p>æ­¤æ—¶é¡µé¢å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªéªŒè¯æœåŠ¡äº†ã€‚</p>

<h4>1.åç«¯</h4>

<p>åç«¯æ‹¿åˆ°æäº¤çš„è¡¨å•åï¼Œéœ€è¦å†å»è¯·æ±‚è…¾è®¯çš„æ¥å£éªŒè¯æ˜¯å¦æˆåŠŸã€‚</p>

<p>å¦‚ä¸‹ï¼š</p>

<pre><code class="language-go">func serveVerify(w http.ResponseWriter, r *http.Request) {
    if r.Method != &quot;POST&quot; {
        http.Error(w, &quot;Method not allowed&quot;, 405)
        return
    }

    r.ParseForm()

    aid := r.Form[&quot;appid&quot;][0]
    AppSecretKey := &quot;yourSecretKey&quot;
    UserIP := r.RemoteAddr
    Ticket :=  r.Form[&quot;ticket&quot;][0]
    Randstr := r.Form[&quot;randstr&quot;][0]

    req, err := http.NewRequest(&quot;GET&quot;, API, nil)
    req.Header.Set(&quot;Content-Type&quot;, &quot;application/x-www-form-urlencoded&quot;)

    q := req.URL.Query()
    q.Add(&quot;aid&quot;, aid)
    q.Add(&quot;AppSecretKey&quot;, AppSecretKey)
    q.Add(&quot;UserIP&quot;, UserIP)
    q.Add(&quot;Ticket&quot;, Ticket)
    q.Add(&quot;Randstr&quot;, Randstr)
    req.URL.RawQuery = q.Encode()

    httpClient := &amp;http.Client{
        Timeout: 10*time.Second,
    }

    fmt.Println(&quot;going to check :&quot;,req.URL.String())

    resp, err := httpClient.Do(req)
    defer resp.Body.Close()
    if err != nil {
        w.Write([]byte(&quot;got error&quot;))
    }

    body, err := ioutil.ReadAll(resp.Body)
    if err != nil {
        w.Write([]byte(&quot;got error&quot;))
    }

    w.Write(body)
}
</code></pre>

<p>è…¾è®¯æœåŠ¡å™¨å°†è¿”å› <code>{response:1, evil_level:70, err_msg:&quot;&quot;}</code> ç±»ä¼¼çš„å†…å®¹ã€‚å…¶ä¸­ï¼š</p>

<p>response = 1 è¡¨ç¤ºéªŒè¯æˆåŠŸã€‚</p>

<p>evil_level æ˜¯æ¶æ„ç­‰çº§ï¼ŒèŒƒå›´ä¸º0-100ã€‚</p>

<p>response = 1 å³è¡¨ç¤ºæ­¤æ¬¡è¯·æ±‚æ˜¯â€œæ­£å¸¸â€çš„ã€‚</p>

<h3>æ€»ç»“</h3>

<p>ç¡®å®å¾ˆå®¹æ˜“æ¥å…¥ï¼Œè€Œä¸”è¿˜æä¾›äº†éªŒè¯æ•°æ®çš„è¯·æ±‚ç»Ÿè®¡ç­‰ï¼ŒåŒ…æ‹¬é€šè¿‡ä¸æ‹¦æˆªçš„æ•°æ®ï¼Œæ—¥è¯·æ±‚é‡ï¼Œé€šè¿‡é‡ï¼Œæ‹¦æˆªé‡ã€‚</p>

<p>åå°è¿˜æä¾›äº†å¯¹åœºæ™¯æ›´æ”¹çš„æ“ä½œï¼Œä¹Ÿå¯ä»¥å®šåˆ¶å¤–è§‚ã€‚</p>

<p>æ•´ä½“è¿˜ä¸é”™ã€‚</p>

                    </div>
                    <footer class="article-footer">
                      <a href="https://qichengzx.github.io/2018/06/15/qq-007-captcha.html#comments" class="article-comment-link">Comments</a>
                      
                        <ul class="article-tag-list">
                        
                          <li class="article-tag-list-item">
                            <a class="article-tag-list-link" href="/tags/qq">qq</a>
                          </li>
                        
                          <li class="article-tag-list-item">
                            <a class="article-tag-list-link" href="/tags/captcha">captcha</a>
                          </li>
                        
                        </ul>
                      
                    </footer>
                  </div>
                  <nav id="article-nav">
                    

                    
                  </nav>
                </article>

        
        
                <article id="0ed64423505b7314946d929b6d1cb037" class="article" itemscope itemprop="blogPost">
                  <div class="article-meta">
                    <a href="https://qichengzx.github.io/2018/05/29/git-pull-upstream.html" class="article-date">
                      <time itemprop="datePublished">2018-05-29 17:45:12</time>
                    </a>
                    <div class="article-category">
                      <a class="article-category-link" href="/categories/git">git</a>
                    </div>
                  </div>
                  <div class="article-inner">
                    <header class="article-header">
                      <h1 itemprop="name">
                        <a class="article-title" href="https://qichengzx.github.io/2018/05/29/git-pull-upstream.html">Git åŒæ­¥ä¸Šæ¸¸æºæ›´æ”¹</a>
                      </h1>
                    </header>
                    <div class="article-entry" itemprop="articleBody">
                      <p>åœ¨ Git ä¸Š fork äº†ä¸€ä¸ªé¡¹ç›®åï¼Œå¦‚æœæ²¡æœ‰ç»å¸¸åˆå¹¶ä¸Šæ¸¸çš„æ›´æ”¹ï¼Œæˆ–è€… fork åçš„é¡¹ç›®æäº¤ä»£ç åæ²¡æœ‰æäº¤åˆ°ä¸Šæ¸¸ï¼Œå°±ä¼šå‡ºç°</p>

<pre><code class="language-shell">This branch is X commits ahead, Y commits behindâ€
</code></pre>

<p>å¯ä»¥é€šè¿‡å¦‚ä¸‹çš„æ–¹å¼åŒæ­¥ä¸Šæ¸¸é¡¹ç›®ã€‚</p>

<p>åœ¨æœ¬åœ°æ·»åŠ ä¸Šæ¸¸é¡¹ç›®:</p>

<pre><code class="language-shell">git remote add upstream git@github:upstream/repo.git
</code></pre>

<p>å½“éœ€è¦åŒæ­¥æ—¶ï¼Œæ‰§è¡Œ:</p>

<pre><code class="language-shell">git pull --rebase upstream master
git push --force-with-lease origin master
</code></pre>

<p>â€“rebase å’Œ â€“force-with-lease é€‰é¡¹åœ¨æ²¡æœ‰åˆå¹¶åˆ°ä¸Šæ¸¸æäº¤æ—¶æ‰æœ‰å¿…è¦ã€‚</p>

<p>ä»¥ä¸‹è¿˜æœ‰å‡ ä¸ªå¯ä»¥ç”¨åˆ°çš„å‘½ä»¤:</p>

<p>é‡ç½®æœ¬åœ°çš„æ›´æ”¹åˆ°ä¸Šæ¸¸çš„çŠ¶æ€:</p>

<pre><code class="language-shell">git reset --hard upstream/master
</code></pre>

<p>å…¶å®é€šå¸¸ä½¿ç”¨ä¸­ï¼Œå»ºè®®ä¸º åŠŸèƒ½/é”™è¯¯ä¿®å¤ åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯ã€‚è¿™æ ·å¯ä»¥åœ¨ç­‰å¾… PR è¢«åˆå¹¶æ—¶ï¼Œå¼€å§‹å¦ä¸€ä¸ª åŠŸèƒ½/é”™è¯¯ä¿®å¤ çš„å¼€å‘ã€‚å¦‚æœä»ä¸ç›´æ¥æäº¤ç»™ masterï¼Œé‚£ä¹ˆå¯ä»¥ä¸ç”¨ä½¿ç”¨ â€“rebase æˆ– â€“force-with-lease è¿›è¡ŒåŒæ­¥:</p>

<pre><code class="language-shell">git checkout master
git pull upstream master
git push origin master
</code></pre>

<p>åœ¨æ›´æ–°ä¸»åˆ†æ”¯åæ›´æ–°åŠŸèƒ½åˆ†æ”¯:</p>

<pre><code class="language-shell">git checkout myfeature
git rebase master
git push --force-with-lease origin myfeature
</code></pre>

                    </div>
                    <footer class="article-footer">
                      <a href="https://qichengzx.github.io/2018/05/29/git-pull-upstream.html#comments" class="article-comment-link">Comments</a>
                      
                        <ul class="article-tag-list">
                        
                          <li class="article-tag-list-item">
                            <a class="article-tag-list-link" href="/tags/git">git</a>
                          </li>
                        
                        </ul>
                      
                    </footer>
                  </div>
                  <nav id="article-nav">
                    

                    
                  </nav>
                </article>

        
        
                <article id="56fa7b149a4280d340a829e2ea587fea" class="article" itemscope itemprop="blogPost">
                  <div class="article-meta">
                    <a href="https://qichengzx.github.io/2018/05/13/create-a-single-page-app-with-go-echo-and-vue.html" class="article-date">
                      <time itemprop="datePublished">2018-05-13 11:19:27</time>
                    </a>
                    <div class="article-category">
                      <a class="article-category-link" href="/categories/golang">golang</a>
                    </div>
                  </div>
                  <div class="article-inner">
                    <header class="article-header">
                      <h1 itemprop="name">
                        <a class="article-title" href="https://qichengzx.github.io/2018/05/13/create-a-single-page-app-with-go-echo-and-vue.html">ã€è¯‘ã€‘ä½¿ç”¨ Goï¼ŒEcho å’Œ Vue åˆ›å»ºå•é¡µ TODO åº”ç”¨</a>
                      </h1>
                    </header>
                    <div class="article-entry" itemprop="articleBody">
                      <p>æœ¬æ•™ç¨‹ä¸­æˆ‘ä»¬å°†ä¼šåˆ›å»ºä¸€ä¸ª â€œtodoâ€ åº”ç”¨ã€‚å®Œæˆåå¯ä»¥å®ç°åˆ›å»ºä»»åŠ¡ï¼Œå±•ç¤ºæ–°åˆ›å»ºçš„ä»»åŠ¡å’Œåˆ é™¤å®ƒä»¬ã€‚</p>

<p>æ­¤ç¨‹åºåç«¯ä½¿ç”¨ Go è¯­è¨€ã€‚Go ç”± Google å¼€å‘ã€‚è™½ç„¶ä¸æ˜¯æœ€æµè¡Œçš„è¯­è¨€ï¼Œä½†æ˜¯æ­£åœ¨é€æ­¥å¾—åˆ°è®¤å¯ã€‚Go éå¸¸è½»é‡çº§ï¼Œæ˜“äºå­¦ä¹ ï¼Œè¿è¡Œå¿«ã€‚æ­¤æ•™ç¨‹å‡è®¾ä½ å·²ç»å¯¹äºè¿™é—¨è¯­è¨€æœ‰äº†ä¸€äº›äº†è§£ï¼Œå¹¶ä¸”å·²ç»å®‰è£…å’Œé…ç½®å¥½äº†å¼€å‘ç¯å¢ƒã€‚</p>

<p>æˆ‘ä»¬å°†ä¼šä½¿ç”¨ Echo æ¡†æ¶ï¼ŒEcho æ¡†æ¶ç›¸å½“äº PHP è¯­è¨€çš„ Slim PHP æˆ– Lumen æ¡†æ¶ï¼Œä½ åº”è¯¥æœ‰ç‚¹ç†Ÿæ‚‰ä½¿ç”¨å¾®æ¡†æ¶å’Œä½¿ç”¨è·¯ç”±å¤„ç† http è¯·æ±‚çš„æ¦‚å¿µã€‚</p>

<p>ä»»åŠ¡æ•°æ®å°†ä¼šå‚¨å­˜åœ¨ SQLite æ•°æ®åº“ä¸­ï¼ŒSQLite æ˜¯ä¸€ä¸ªè½»é‡çº§çš„å¯æ›¿ä»£ MySQL æˆ– PostgreSQL çš„æ•°æ®åº“ã€‚æ•°æ®ä¼šå­˜åœ¨ä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ä¸­ï¼Œä¸åº”ç”¨åœ¨åŒä¸€ç›®å½•è€Œä¸æ˜¯å­˜åœ¨æœåŠ¡å™¨ä¸Šã€‚</p>

<p>æœ€åï¼Œå‰ç«¯ä½¿ç”¨ HTML5 å’Œæµè¡Œçš„ VueJS JavaScript æ¡†æ¶ï¼Œéœ€è¦å¯¹ VueJS æœ‰ä¸€å®šçš„äº†è§£ã€‚</p>

<p>æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°†åˆ†è§£æˆå››ä¸ªåŸºæœ¬éƒ¨åˆ†ã€‚æˆ‘ä»¬å°†æ‹¥æœ‰æˆ‘ä»¬çš„ä¸»åŒ…ï¼Œç”¨æ¥è®¾ç½®è·¯ç”±å’Œæ•°æ®åº“ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æœ‰å‡ ä¸ªå¤„ç†ç¨‹åºç”¨æ¥å¤„ç†ä¸åŒçš„è·¯ç”±ã€‚ å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿä¼šæœ‰ä¸€ä¸ª Task æ¨¡å‹ï¼Œå®ƒå°†ä½¿ç”¨ SQLite è¿›è¡ŒæŒä¹…åŒ–ã€‚æœ€åï¼Œåº”ç”¨ç¨‹åºå°†æœ‰ä¸€ä¸ªç®€å•çš„ index.html æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æˆ‘ä»¬çš„ HTML5 å’Œ VueJS å®¢æˆ·ç«¯ä»£ç ã€‚ è®©æˆ‘ä»¬æ·±å…¥æŒ–æ˜ï¼</p>

<h2>è·¯ç”±å’Œæ•°æ®åº“</h2>

<p>åœ¨å…¥å£æ–‡ä»¶ä¸­ä¼šå¼•å…¥å‡ ä¸ªåŒ…ã€‚â€database/sqlâ€ æ˜¯Goæ ‡å‡†åŒ…ï¼Œä½†æ˜¯ Echo å’Œ SQLite éœ€è¦ä» Github ä¸‹è½½ã€‚</p>

<pre><code class="language-shell">$ go get github.com/labstack/echo
$ go get github.com/mattn/go-sqlite3
</code></pre>

<p>ç„¶ååˆ›å»ºåº”ç”¨çš„ç›®å½•ã€‚</p>

<pre><code class="language-shell">$ cd $GOPATH/src
$ mkdir go-echo-vue &amp;&amp; cd go-echo-vue
</code></pre>

<p>ç°åœ¨å¼€å§‹å†™è·¯ç”±ï¼Œåœ¨ go-echo-vue ç›®å½•åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¹¶å‘½åä¸º â€œtodo.goâ€ ï¼Œç„¶åå¼•å…¥ Echo æ¡†æ¶ã€‚</p>

<pre><code class="language-golang">// todo.go
package main

import (
	&quot;github.com/labstack/echo&quot;
	&quot;github.com/labstack/echo/engine/standard&quot;
)
</code></pre>

<p>ä¸‹ä¸€æ­¥ï¼Œåˆ›å»ºgoç¨‹åºå¿…éœ€çš„ â€œmainâ€ æ–¹æ³•ã€‚</p>

<pre><code class="language-golang">// todo.go
func main() { }
</code></pre>

<p>ä¸ºäº†ä½¿å‰ç«¯çš„ VueJS å¯ä»¥å’Œåç«¯é€šä¿¡ï¼Œåˆ›å»ºä»»åŠ¡ï¼Œéœ€è¦è®¾ç½®ä¸€äº›åŸºæœ¬çš„è·¯ç”±ã€‚ç¬¬ä¸€ä»¶äº‹å°±æ˜¯å®ä¾‹åŒ–ä¸€ä¸ª Echo ã€‚ç„¶åä½¿ç”¨å…§å»ºæ–¹æ³•å®šä¹‰å‡ ä¸ªè·¯ç”±ã€‚å¦‚æœä½¿ç”¨è¿‡å…¶ä»–æ¡†æ¶ï¼Œåº”è¯¥ä¼šç†Ÿæ‚‰è¿™ä¸ªæ¦‚å¿µã€‚</p>

<p>è·¯ç”±ä½¿ç”¨ä¸€ä¸ªæ­£åˆ™ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œç„¶åä½¿ç”¨ä¸€ä¸ªå¤„ç†æ–¹æ³•ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ã€‚åœ¨æ­¤æ•™ç¨‹ä¸­å¿…é¡»ä½¿ç”¨ Echo.HandlerFunc æ¥å£ã€‚</p>

<p>ç°åœ¨å¯ä»¥åœ¨ â€œmainâ€ æ–¹æ³•ä¸­åˆ›å»ºå‡ ä¸ªç»™å‰ç«¯é€šä¿¡ä½¿ç”¨çš„è·¯ç”±äº†ã€‚</p>

<pre><code class="language-golang">// todo.go
func main() {
    // Create a new instance of Echo
    e := echo.New()

    e.GET(&quot;/tasks&quot;, func(c echo.Context) error { return c.JSON(200, &quot;GET Tasks&quot;) })
    e.PUT(&quot;/tasks&quot;, func(c echo.Context) error { return c.JSON(200, &quot;PUT Tasks&quot;) })
    e.DELETE(&quot;/tasks/:id&quot;, func(c echo.Context) error { return c.JSON(200, &quot;DELETE Task &quot;+c.Param(&quot;id&quot;)) })

    // Start as a web server
    e.Run(standard.New(&quot;:8000&quot;))
}
</code></pre>

<p>ä»¥ä¸Šè·¯ç”±åªè¾“å‡ºäº†å›ºå®šçš„æ–‡æœ¬å†…å®¹ï¼Œå°†ä¼šåœ¨æ¥ä¸‹æ¥æ”¹è¿›ã€‚</p>

<p>å¯ä»¥ä½¿ç”¨ Postman æµ‹è¯•ä»¥ä¸Šæ¥å£ã€‚</p>

<pre><code class="language-shell">$ go build todo.go
$ ./todo
</code></pre>

<p>è¿è¡Œåï¼Œæ‰“å¼€ Postmanï¼Œè¾“å…¥ localhost:8000ï¼Œé€‰æ‹© GET æ¥æµ‹è¯• â€œ/tasksâ€ è·¯ç”±ï¼Œæ­£å¸¸å¯ä»¥çœ‹åˆ° â€œGET Tasksâ€ã€‚</p>

<p><img src="/images/create-a-single-page-app-with-go-echo-and-vue/o2AE4E3lRzmGDo9I4Uqv_get_tasks.png" alt="" /></p>

<p><img src="/images/create-a-single-page-app-with-go-echo-and-vue/Et8CnQzSZihek28dvsoL_put_tasks.png" alt="" /></p>

<p><img src="/images/create-a-single-page-app-with-go-echo-and-vue/L2MH4UkDTQG6tBjW492c_delete_tasks.png" alt="" /></p>

<p>ç„¶åæ˜¯é…ç½®æ•°æ®åº“ï¼ŒæŒ‡å®šå­˜å‚¨æ–‡ä»¶ä¸º â€œstorage.dbâ€ ï¼Œå¦‚æœä¸å­˜åœ¨ç¨‹åºä¼šè‡ªåŠ¨åˆ›å»ºã€‚æ•°æ®åº“åˆ›å»ºåéœ€è¦è¿è¡Œæ•°æ®è¿ç§»ã€‚</p>

<pre><code class="language-golang">// todo.go

import (
	&quot;database/sql&quot;

	&quot;github.com/labstack/echo&quot;
	&quot;github.com/labstack/echo/engine/standard&quot;
	_ &quot;github.com/mattn/go-sqlite3&quot;
)
</code></pre>

<p>åœ¨ main æ–¹æ³•é‡Œå¢åŠ </p>

<pre><code class="language-golang">// todo.go
func main() {
	db := initDB(&quot;storage.db&quot;)
	migrate(db)
</code></pre>

<p>ç„¶åéœ€è¦å®šä¹‰ initDB å’Œ migrate æ–¹æ³•ã€‚</p>

<pre><code class="language-golang">// todo.go
func initDB(filepath string) *sql.DB {
	db, err := sql.Open(&quot;sqlite3&quot;, filepath)

	//æ£€æŸ¥é”™è¯¯
	if err != nil {
		panic(err)
	}

	//å¦‚æœopenæ²¡æœ‰æŠ¥é”™ï¼Œä½†æ˜¯ä»ç„¶æ²¡æœ‰æ•°æ®åº“è¿æ¥ï¼Œä¸€æ ·è¦é€€å‡º
	if db == nil {
		panic(&quot;db nil&quot;)
	}

	return db
}

func migrate(db *sql.DB) {
	sql := `
	CREATE TABLE IF NOT EXISTS tasks(
		id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
		name VARCHAR NOT NULL
	);
	`

	_, err := db.Exec(sql)

	//å‡ºé”™é€€å‡º
	if err != nil {
		panic(err)
	}
}
</code></pre>

<p>è¿™ä¸¤ä¸ªæ–¹æ³•ç”¨äºè¿æ¥æ•°æ®åº“ï¼Œå»ºè¡¨ã€‚â€initDBâ€ ä¼šæ‰“å¼€ä¸€ä¸ª db æ–‡ä»¶æˆ–è€…åˆ›å»ºå®ƒã€‚å¦‚æœå¤±è´¥ç¨‹åºä¼šé€€å‡ºã€‚</p>

<p>â€œmigrateâ€ æ–¹æ³•è¿è¡Œåˆ›å»ºè¡¨çš„ SQL ã€‚å¦‚æœå¤±è´¥ç¨‹åºé€€å‡ºã€‚</p>

<p>ç„¶å</p>

<pre><code class="language-shell">$ go build todo.go
$ ./todo
</code></pre>

<p>æŸ¥çœ‹æ•ˆæœã€‚</p>

<p>å¦‚æœæ‰“å¼€å¦ä¸€ä¸ªç»ˆç«¯ï¼Œåˆ—å‡ºå½“å‰ç›®å½•å†…å®¹æ—¶ä¼šå‘ç°å·²ç»åˆ›å»ºäº† â€œstorage.dbâ€ ,æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥ç¡®è®¤å®ƒç¡®å®æ˜¯ä¸ª SQLite æ–‡ä»¶ã€‚</p>

<pre><code class="language-shell">$ sqlite3 storage.db
</code></pre>

<p>éœ€è¦å®‰è£… <a href="https://www.sqlite.org/download.html">SQLite</a> æ‰å¯ä»¥æ‰§è¡Œæ­¤å‘½ä»¤ã€‚</p>

<p>æ­¤å‘½ä»¤ä¼šç»™å‡ºæç¤ºï¼Œè¾“å…¥ â€œ.tablesâ€ ï¼Œå¯ä»¥åˆ—å‡ºæ‰€æœ‰çš„è¡¨ï¼Œè¾“å…¥ â€œ.quitâ€ é€€å‡ºã€‚</p>

<p><img src="/images/create-a-single-page-app-with-go-echo-and-vue/pDLs76QxRVuxllrUPOqV_sqlite3.png" alt="" /></p>

<h2>å¤„ç†è¯·æ±‚</h2>

<p>ä¹‹å‰å·²ç»åˆ›å»ºäº†ä¸å‰ç«¯äº¤äº’çš„æ¥å£ï¼Œç°åœ¨éœ€è¦åˆ›å»ºæˆ–åˆ é™¤ä»»åŠ¡æ—¶ç»™å®¢æˆ·ç«¯çœŸå®çš„ç»“æœã€‚è¿™éœ€è¦å‡ ä¸ªæ–¹æ³•å»å®Œæˆã€‚</p>

<p>åœ¨ â€œtodo.goâ€ ä¸­éœ€è¦å¼•å…¥æ–°çš„åŒ…ã€‚</p>

<pre><code class="language-golang">package main
import (
    &quot;database/sql&quot;
    &quot;go-echo-vue/handlers&quot;

    &quot;github.com/labstack/echo&quot;
    &quot;github.com/labstack/echo/engine/standard&quot;
    _ &quot;github.com/mattn/go-sqlite3&quot;
)
</code></pre>

<p>ç„¶åä¿®æ”¹è·¯ç”±ï¼Œä½¿ç”¨åˆšåˆšåˆ›å»ºçš„ handlers åŒ…å»å¤„ç†ã€‚</p>

<pre><code class="language-golang">// todo.go
    e := echo.New()

    e.File(&quot;/&quot;, &quot;public/index.html&quot;)
    e.GET(&quot;/tasks&quot;, handlers.GetTasks(db))
    e.PUT(&quot;/tasks&quot;, handlers.PutTask(db))
    e.DELETE(&quot;/tasks/:id&quot;, handlers.DeleteTask(db))

    e.Run(standard.New(&quot;:8000&quot;))
}
</code></pre>

<p>æŸ¥çœ‹è¿™æ®µä»£ç ï¼Œä½ å¯èƒ½ä¼šæ³¨æ„åˆ°åˆ—å‡ºçš„å¤„ç†ç¨‹åºå®é™…ä¸Šå¹¶ä¸éµå¾ª Echo æ‰€è¦æ±‚çš„å‡½æ•°ç­¾åã€‚ç›¸åï¼Œè¿™äº›å‡½æ•°è¿”å›ä¸€ä¸ªæ»¡è¶³è¯¥æ¥å£çš„å‡½æ•°ã€‚è¿™æ˜¯æˆ‘ç”¨è¿‡çš„ä¸€ä¸ªæŠ€å·§ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°† db å®ä¾‹ä» handler ä¼ é€’åˆ° handler ï¼Œè€Œä¸å¿…åœ¨æ¯æ¬¡æˆ‘ä»¬è¦ä½¿ç”¨æ•°æ®åº“æ—¶åˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹ã€‚ç¨åä¼šæ›´æ¸…æ¥šã€‚</p>

<p>æˆ‘ä»¬è¿˜å¢åŠ äº†ä¸€æ¡é¢å¤–çš„è·¯ç”±ã€‚è¿™æ˜¯ä¸€ä¸ªåŒ…å«æˆ‘ä»¬çš„ VueJS å®¢æˆ·ç«¯ä»£ç çš„é™æ€ html æ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ â€œFileâ€ åŠŸèƒ½æä¾›é™æ€æ–‡ä»¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†åœ¨è®¿é—® â€œ/â€œ çš„æ—¶å€™è¾“å‡ºæˆ‘ä»¬çš„å®¢æˆ·ç«¯ä»£ç ã€‚</p>

<p>ç„¶ååˆ›å»ºä¸€ä¸ªåä¸º â€œhandlersâ€ çš„ç›®å½•ï¼Œå¹¶åœ¨è¯¥ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªåä¸º â€œtasks.goâ€ çš„æ–‡ä»¶ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å¯¼å…¥ä¸€äº›æˆ‘ä»¬éœ€è¦çš„è½¯ä»¶åŒ…ã€‚</p>

<pre><code class="language-golang">// handlers/tasks.go
package handlers

import (
    &quot;database/sql&quot;
    &quot;net/http&quot;
    &quot;strconv&quot;

    &quot;github.com/labstack/echo&quot;
)
</code></pre>

<p>æ¥ä¸‹æ¥çš„è¿™ä¸€è¡Œä»£ç ï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨å“åº”ä¸­è¿”å›ä»»æ„çš„ JSON ï¼Œå°±åƒä½ ç¨åä¼šçœ‹åˆ°çš„ä¸€æ ·ã€‚è¿™æ˜¯ä¸€ä¸ªä»¥å­—ç¬¦ä¸²ä½œä¸º key ï¼Œä»»æ„ç±»å‹ä½œä¸ºå€¼çš„ map ç»“æ„ã€‚ åœ¨Goä¸­ï¼Œâ€interfaceâ€ å…³é”®å­—è¡¨ç¤ºä»åŸå§‹æ•°æ®ç±»å‹åˆ°ç”¨æˆ·å®šä¹‰ç±»å‹æˆ–ç»“æ„çš„ä»»ä½•å†…å®¹ã€‚</p>

<pre><code class="language-golang">// hanlers/tasks.go
type H map[string]interface{}
</code></pre>

<p>è¿™ä¸ªæ–‡ä»¶ä¸»è¦æ˜¯å¤„ç†å‡½æ•°ã€‚å®ƒä»¬éƒ½ä»¥ db è¿æ¥ä½œä¸ºå‚æ•°ï¼Œä½†è¦è®°ä½ï¼Œ Echo è·¯ç”±çš„æ­£ç¡®å¤„ç†ç¨‹åºï¼Œéœ€è¦å®ç° Echo.HandlerFunc æ¥å£ã€‚ æˆ‘ä»¬é€šè¿‡è¿”å›ä¸æ¥å£ç­¾ååŒ¹é…çš„åŒ¿åå‡½æ•°æ¥å®ç°æ­¤ç›®æ ‡ã€‚è¯¥å‡½æ•°ç°åœ¨å¯ä»¥ä½¿ç”¨æ•°æ®åº“è¿æ¥å¹¶å°†å…¶ä¼ é€’ç»™æˆ‘ä»¬çš„æ¨¡å‹ã€‚</p>

<p>ä¸ºäº†èƒ½æ­£å¸¸å·¥ä½œï¼Œæš‚æ—¶æˆ‘ä»¬ä¸ä¼šå¤„ç†æ•°æ®åº“ã€‚åªä¼šè¿”å›ä¸€äº›å‡æ•°æ®ã€‚</p>

<pre><code class="language-golang">// handlers/tasks.go

// GetTasks endpoint
func GetTasks(db *sql.DB) echo.HandlerFunc {
    return func(c echo.Context) error {
        return c.JSON(http.StatusOK, &quot;tasks&quot;)
    }
}

// PutTask endpoint
func PutTask(db *sql.DB) echo.HandlerFunc {
    return func(c echo.Context) error {
        return c.JSON(http.StatusCreated, H{
            &quot;created&quot;: 123,
    }
}

// DeleteTask endpoint
func DeleteTask(db *sql.DB) echo.HandlerFunc {
    return func(c echo.Context) error {
        id, _ := strconv.Atoi(c.Param(&quot;id&quot;))
        return c.JSON(http.StatusOK, H{
            &quot;deleted&quot;: id,
        })
    }
}
</code></pre>

<p>Go http è½¯ä»¶åŒ…ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€äº›ä¾¿åˆ©çš„å¸¸é‡æ¥è¡¨ç¤º HTTP çŠ¶æ€ä»£ç ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä½¿ç”¨ http.StatusCreated ä½œä¸ºæˆ‘ä»¬çš„ PUT å“åº”ã€‚ è¿™äº›å¤„ç†ç¨‹åºä¸­çš„æ¯ä¸€ä¸ªç°åœ¨éƒ½ä¼šè¿”å› JSON æ ¼å¼çš„å“åº”ã€‚æœ€åä¸€ä¸ªå‡½æ•° â€œDeleteTaskâ€ éœ€è¦ä¸€ä¸ª id å‚æ•°ã€‚æˆ‘ä»¬ä½¿ç”¨ strconv åŒ…å’Œ Atoiï¼ˆalpha to integerï¼‰å‡½æ•°æ¥ç¡®ä¿ id è¢«è½¬æ¢ä¸ºæ•´æ•°ã€‚ ä¿è¯åœ¨é€šè¿‡æ•°æ®åº“ä¸­çš„ id æŸ¥è¯¢ä»»åŠ¡æ—¶æ­£ç¡®ä½¿ç”¨å®ƒã€‚</p>

<p>è¦æµ‹è¯•è¿™äº›å¤„ç†ç¨‹åºï¼Œè¦é‡æ–°ç¼–è¯‘å¹¶è¿è¡Œåº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Postman å†æ¬¡æµ‹è¯•ã€‚</p>

<p><img src="/images/create-a-single-page-app-with-go-echo-and-vue/yxMJc9YQQgWA9HhbComc_get_tasks_handler.webp" alt="" /></p>

<p><img src="/images/create-a-single-page-app-with-go-echo-and-vue/fWkK9dmFS8eR6CxZfXCA_put_tasks_handler.webp" alt="" /></p>

<p><img src="/images/create-a-single-page-app-with-go-echo-and-vue/SGWxvMXS3m4s10NjBMKQ_delete_tasks_handler.webp" alt="" /></p>

<h2>MODEL</h2>

<p>ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€éƒ¨åˆ†å¤„ç†ç¨‹åºï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºéœ€è¦ä½¿ç”¨æ•°æ®åº“ã€‚ä½†æ˜¯æˆ‘ä»¬ä¸æ˜¯ç›´æ¥ä»å¤„ç†ç¨‹åºè¿›è¡Œæ•°æ®åº“è°ƒç”¨ï¼Œè€Œæ˜¯é€šè¿‡å°†æ•°æ®åº“é€»è¾‘æŠ½è±¡ä¸ºæ¨¡å‹æ¥ä¿æŒä»£ç çš„æ•´æ´ã€‚</p>

<p>é¦–å…ˆè®©æˆ‘ä»¬åœ¨æ–°åˆ›å»ºçš„å¤„ç†ç¨‹åºæ–‡ä»¶ä¸­å¼•ç”¨æˆ‘ä»¬çš„æ–°æ¨¡å‹ã€‚</p>

<p>å¯¼å…¥æˆ‘ä»¬å³å°†åˆ›å»ºçš„æ¨¡å‹åŒ…ã€‚</p>

<pre><code class="language-golang">// handlers/tasks.go
package handlers

import (
    &quot;database/sql&quot;
    &quot;net/http&quot;
    &quot;strconv&quot;

    &quot;go-echo-vue/models&quot;

    &quot;github.com/labstack/echo&quot;
)
</code></pre>

<p>ç„¶åå°†è°ƒç”¨æ·»åŠ åˆ°æˆ‘ä»¬çš„å¤„ç†å‡½æ•°ä¸­ã€‚</p>

<pre><code class="language-golang">// handlers/tasks.go

// GetTasks endpoint
func GetTasks(db *sql.DB) echo.HandlerFunc {
    return func(c echo.Context) error {
        // Fetch tasks using our new model
        return c.JSON(http.StatusOK, models.GetTasks(db))
    }
}

// PutTask endpoint
func PutTask(db *sql.DB) echo.HandlerFunc {
    return func(c echo.Context) error {
        // Instantiate a new task
        var task models.Task
        // Map imcoming JSON body to the new Task
        c.Bind(&amp;task)
        // Add a task using our new model
        id, err := models.PutTask(db, task.Name)
        // Return a JSON response if successful
        if err == nil {
            return c.JSON(http.StatusCreated, H{
                &quot;created&quot;: id,
            })
        // Handle any errors
        } else {
            return err
        }
    }
}

// DeleteTask endpoint
func DeleteTask(db *sql.DB) echo.HandlerFunc {
    return func(c echo.Context) error {
        id, _ := strconv.Atoi(c.Param(&quot;id&quot;))
        // Use our new model to delete a task
        _, err := models.DeleteTask(db, id)
        // Return a JSON response on success
        if err == nil {
            return c.JSON(http.StatusOK, H{
                &quot;deleted&quot;: id,
            })
        // Handle errors
        } else {
            return err
        }
    }
}
</code></pre>

<p>ç°åœ¨åœ¨ â€œPutTaskâ€ å‡½æ•°ä¸­ï¼Œä½ ä¼šçœ‹åˆ° â€œc.Bindâ€ã€‚ å°†ä¼šåœ¨ PUT è¯·æ±‚ä¸­å‘é€ JSON æ ¼å¼çš„å“åº”å†…å®¹ï¼Œå¹¶å°†å…¶æ˜ å°„åˆ° Task ç»“æ„ã€‚ Task ç»“æ„å°†åœ¨æˆ‘ä»¬çš„æ¨¡å‹åŒ…ä¸­å®šä¹‰ã€‚</p>

<p>è¿™é‡Œè¿˜éœ€è¦æ³¨æ„ä¸€äº›é”™è¯¯æ£€æŸ¥ã€‚ Tasks Model å…·æœ‰æ ¹æ®æ“ä½œæ˜¯å¦æˆåŠŸè¿”å›æ•°æ®æˆ–é”™è¯¯çš„å‡½æ•°ã€‚æˆ‘ä»¬çš„å¤„ç†ç¨‹åºéœ€è¦åšå‡ºç›¸åº”çš„å¤„ç†ã€‚</p>

<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥åˆ›å»ºæˆ‘ä»¬çš„æ¨¡å‹ã€‚ è¿™æ˜¯å®é™…ä¸æ•°æ®åº“è¿›è¡Œäº¤äº’çš„ã€‚ åˆ›å»ºä¸€ä¸ªåä¸º â€œmodelsâ€ çš„ç›®å½•ï¼Œå¹¶åœ¨è¯¥ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªåä¸º â€œtasks.goâ€ çš„æ–‡ä»¶ã€‚</p>

<p>ç„¶åå¼•å…¥éœ€è¦çš„åŒ…ã€‚</p>

<pre><code class="language-golang">// models/tasks.go
package models

import (
    &quot;database/sql&quot;

    _ &quot;github.com/mattn/go-sqlite3&quot;
)
</code></pre>

<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª Task ç±»å‹ï¼ŒåŒ…å«ä¸¤ä¸ªå­—æ®µ ID å’Œ Nameã€‚ Go å…è®¸ä½¿ç”¨åå¼•å·å°†å…ƒæ•°æ®æ·»åŠ åˆ°å˜é‡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªæ˜¯å®šä¹‰äº†æ¯ä¸ªå­—æ®µåœ¨è½¬æ¢ä¸º JSON åçš„æ ·å­ã€‚ â€œc.Bindâ€ å‡½æ•°åœ¨å¡«å……æ–° Task æ—¶çŸ¥é“åœ¨å¦‚ä½•æ˜ å°„ JSON æ•°æ®ã€‚</p>

<p>å¦å¤–è¿˜éœ€è¦ä¸€ä¸ªè¡¨ç¤º Task çš„é›†åˆçš„æ¨¡å‹ã€‚</p>

<pre><code class="language-golang">// models/tasks.go

// Task is a struct containing Task data
type Task struct {
    ID   int    `json:&quot;id&quot;`
    Name string `json:&quot;name&quot;`
}

// TaskCollection is collection of Tasks
type TaskCollection struct {
    Tasks []Task `json:&quot;items&quot;`
}
</code></pre>

<p>è·å–ä»»åŠ¡åªéœ€ä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ‰€æœ‰ Taskï¼Œå°†å…¶æ”¾åˆ° TaskCollection å¹¶è¿”å›ã€‚</p>

<pre><code class="language-golang">// models/tasks.go

func GetTasks(db *sql.DB) TaskCollection {
    sql := &quot;SELECT * FROM tasks&quot;
    rows, err := db.Query(sql)
    // Exit if the SQL doesn't work for some reason
    if err != nil {
        panic(err)
    }
    // make sure to cleanup when the program exits
    defer rows.Close()

    result := TaskCollection{}
    for rows.Next() {
        task := Task{}
        err2 := rows.Scan(&amp;task.ID, &amp;task.Name)
        // Exit if we get an error
        if err2 != nil {
            panic(err2)
        }
        result.Tasks = append(result.Tasks, task)
    }
    return result
}
</code></pre>

<p>PutTask å°†æ–° Task æ’å…¥æ•°æ®åº“ï¼Œå¹¶åœ¨æˆåŠŸæ—¶è¿”å›æ–°çš„IDï¼Œå¹¶åœ¨å¤±è´¥æ—¶ panicã€‚</p>

<pre><code class="language-golang">// models/tasks.go

func PutTask(db *sql.DB, name string) (int64, error) {
    sql := &quot;INSERT INTO tasks(name) VALUES(?)&quot;

    // Create a prepared SQL statement
    stmt, err := db.Prepare(sql)
    // Exit if we get an error
    if err != nil {
        panic(err)
    }
    // Make sure to cleanup after the program exits
    defer stmt.Close()

    // Replace the '?' in our prepared statement with 'name'
    result, err2 := stmt.Exec(name)
    // Exit if we get an error
    if err2 != nil {
        panic(err2)
    }

    return result.LastInsertId()
}
</code></pre>

<p>DeleteTask ç”¨æ¥åˆ é™¤ Taskã€‚</p>

<pre><code class="language-golang">// models/tasks.go

func DeleteTask(db *sql.DB, id int) (int64, error) {
    sql := &quot;DELETE FROM tasks WHERE id = ?&quot;

    // Create a prepared SQL statement
    stmt, err := db.Prepare(sql)
    // Exit if we get an error
    if err != nil {
        panic(err)
    }

    // Replace the '?' in our prepared statement with 'id'
    result, err2 := stmt.Exec(id)
    // Exit if we get an error
    if err2 != nil {
        panic(err2)
    }

    return result.RowsAffected()
}
</code></pre>

<p>è¯·æ³¨æ„ï¼Œæˆ‘ä»¬é€šè¿‡ â€œdb.Prepareâ€ åœ¨æˆ‘ä»¬çš„æ¨¡å‹å‡½æ•°ä¸­ä½¿ç”¨å‡†å¤‡å¥½çš„ SQL è¯­å¥ã€‚æœ‰ä¸¤ä¸ªåŸå› ã€‚é¦–å…ˆï¼Œä¸€ä¸ªå‡†å¤‡å¥½çš„è¯­å¥å¯ä»¥è¢«ç¼–è¯‘å’Œç¼“å­˜ï¼Œæ‰€ä»¥æ‰§è¡Œå¤šæ¬¡æ›´å¿«ã€‚ å…¶æ¬¡ï¼Œæœ€é‡è¦çš„æ˜¯å‡†å¤‡å¥½çš„è¯­å¥å¯ä»¥é˜²æ­¢ SQL æ³¨å…¥æ”»å‡»ã€‚</p>

<p>ç°åœ¨å†æ¬¡ä½¿ç”¨ Postman ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬å°†æ£€æŸ¥ â€œGET /tasks â€œ ã€‚æ­£å¸¸åº”è¯¥çœ‹åˆ° Tasks ä¸ºç©ºçš„ JSONã€‚</p>

<p><img src="/images/create-a-single-page-app-with-go-echo-and-vue/50DVGi4aQYqctZ14LzMp_get_tasks_null.png" alt="" /></p>

<p>ç°åœ¨æ¥æ·»åŠ ä¸€ä¸ª Task ã€‚ åœ¨ Postman ä¸­ï¼Œå°† HTTPè¯·æ±‚æ–¹å¼åˆ‡æ¢åˆ° â€œPUTâ€ï¼Œç„¶åå•å‡» â€œBodyâ€ é€‰é¡¹å¡ã€‚ é€‰ä¸­ â€œrawâ€ å¹¶é€‰æ‹© JSON(application/json) ä½œä¸ºç±»å‹ã€‚ åœ¨æ–‡æœ¬æ¡†ä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ã€‚</p>

<pre><code class="language-json">{
    &quot;name&quot;: &quot;Foobar&quot;
}
</code></pre>

<p>æäº¤ååº”è¯¥æ”¶åˆ° â€œcreatedâ€ çš„å“åº”ã€‚</p>

<p><img src="/images/create-a-single-page-app-with-go-echo-and-vue/GCY1n7oAR7Siy2Izn1dE_put_tasks_body.png" alt="" /></p>

<p>è®°ä¸‹è¿”å›çš„ id ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦å®ƒæ¥æµ‹è¯• â€œDELETE /tasksâ€ ã€‚ å°±åƒåœ¨å‰é¢çš„ä¾‹å­ä¸­ä¸€æ ·ï¼Œå°†è¯·æ±‚æ–¹å¼è®¾ç½®ä¸º â€œDELETEâ€ å¹¶å°† URL æ”¹ä¸º â€œ/tasks/:idâ€ ã€‚ åœ¨æˆ‘ä»¬ä»¥å‰çš„æµ‹è¯•ä¸­ç”¨ â€œidâ€ æ›¿æ¢ â€œ:idâ€ã€‚ ä½ åº”è¯¥å¾—åˆ°ä¸€ä¸ªæˆåŠŸçš„ â€œdeletedâ€ æ¶ˆæ¯ã€‚</p>

<p><img src="/images/create-a-single-page-app-with-go-echo-and-vue/WYuIfNAaSvKEN00TpwLE_delete_tasks_id.png" alt="" /></p>

<p>ç°åœ¨å¯ä»¥å†æ¬¡è¯·æ±‚ â€œGET /tasksâ€ï¼Œæ­£å¸¸åº”è¯¥è¿”å› â€œnullâ€ã€‚</p>

<h2>å‰ç«¯</h2>

<p>ç°åœ¨æ¥å¤„ç†æˆ‘ä»¬çš„å‰ç«¯é¡µé¢ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œå°†æˆ‘ä»¬çš„ Javascript ä»£ç å†™åœ¨ HTML ä¸­ã€‚æ ‡è®°å¾ˆç®€å•ã€‚ æˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€äº›åº“ï¼Œå¦‚ Bootstrapï¼ŒJQueryï¼Œå½“ç„¶è¿˜æœ‰ VueJSã€‚ ç”¨æˆ·ç•Œé¢åªæ˜¯ä¸€ä¸ªè¾“å…¥æ¡†ï¼Œä¸€äº›æŒ‰é’®å’Œä»»åŠ¡çš„åˆ—è¡¨ã€‚ åˆ›å»ºä¸€ä¸ªåä¸º â€˜publicâ€™ çš„ç›®å½•ï¼Œå¹¶åœ¨è¯¥ç›®å½•å†…åˆ›å»ºä¸€ä¸ªåä¸º â€œindex.htmlâ€ çš„æ–‡ä»¶ã€‚</p>

<pre><code class="language-html">&lt;!-- public/index.html --&gt;

&lt;html&gt;
    &lt;head&gt;
        &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;

        &lt;title&gt;TODO App&lt;/title&gt;

        &lt;!-- Latest compiled and minified CSS --&gt;
        &lt;link rel=&quot;stylesheet&quot; href=&quot;https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css&quot;&gt;

        &lt;!-- Font Awesome --&gt;
        &lt;link rel=&quot;stylesheet&quot; href=&quot;https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css&quot;&gt;

        &lt;!-- JQuery --&gt;
        &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js&quot;&gt;&lt;/script&gt;

        &lt;!-- Latest compiled and minified JavaScript --&gt;
        &lt;script src=&quot;https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js&quot;&gt;&lt;/script&gt;

        &lt;!-- Vue.js --&gt;
        &lt;script src=&quot;http://cdnjs.cloudflare.com/ajax/libs/vue/1.0.24/vue.min.js&quot;&gt;&lt;/script&gt;
        &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/vue-resource/0.7.0/vue-resource.min.js&quot;&gt;&lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div class=&quot;container&quot;&gt;
            &lt;div class=&quot;row&quot;&gt;
                &lt;div class=&quot;col-md-4&quot;&gt;
                    &lt;h2&gt;My Tasks&lt;/h2&gt;
                    &lt;ul class=&quot;list-group&quot;&gt;
                        &lt;li class=&quot;list-group-item&quot; v-for=&quot;task in tasks&quot;&gt;
                            {{ task.name }}
                            &lt;span class=&quot;pull-right&quot;&gt;
                                &lt;button class=&quot;btn btn-xs btn-danger&quot; v-on:click=&quot;deleteTask($index)&quot;&gt;
                                    &lt;i class=&quot;fa fa-trash-o&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;
                                &lt;/button&gt;
                            &lt;/span&gt;
                        &lt;/li&gt;
                    &lt;/ul&gt;
                    &lt;div class=&quot;input-group&quot;&gt;
                        &lt;input type=&quot;text&quot; class=&quot;form-control&quot; placeholder=&quot;New Task&quot; v-on:keyup.enter=&quot;createTask&quot; v-model=&quot;newTask.name&quot;&gt;
                        &lt;span class=&quot;input-group-btn&quot;&gt;
                            &lt;button class=&quot;btn btn-primary&quot; type=&quot;button&quot; v-on:click=&quot;createTask&quot;&gt;Create&lt;/button&gt;
                        &lt;/span&gt;
                    &lt;/div&gt;&lt;!-- /input-group --&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>ç°åœ¨é‡æ–°è¿è¡Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œç„¶åæ‰“å¼€ â€œ<a href="http://localhost:8000">http://localhost:8000</a>&ldquo;ã€‚</p>

<p><img src="/images/create-a-single-page-app-with-go-echo-and-vue/JamFkkfkSaOKBlsqjzBU_todo_ui.png" alt="" /></p>

<p>åœ¨æœ€åçš„ â€œdivâ€ æ ‡ç­¾ä¸‹ï¼Œå°†æˆ‘ä»¬çš„ VueJS ä»£ç æ”¾åœ¨ä¸€ä¸ª â€œscriptâ€ æ ‡ç­¾ä¸­ã€‚ VueJS ä»£ç ç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œä½†ä¹Ÿéå¸¸æ˜æ˜¾ã€‚ æˆ‘ä»¬æœ‰å‡ ä¸ªåˆ›å»ºå’Œåˆ é™¤ä»»åŠ¡çš„æ–¹æ³•ä»¥åŠä¸€ä¸ªåœ¨åˆå§‹åŒ–æ—¶è¿è¡Œçš„æ–¹æ³•ã€‚åˆå§‹åŒ–æ—¶è·å–å½“å‰å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„æ‰€æœ‰ä»»åŠ¡ã€‚</p>

<p>ä¸ºäº†ä¸åç«¯è¿›è¡Œé€šä¿¡ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ HTTP å®¢æˆ·ç«¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ vue-resourceã€‚ å¯ä»¥é€šè¿‡å¼•ç”¨ â€œthis.$httpâ€ ç„¶åä½¿ç”¨ä»»ä½• HTTP è¯·æ±‚æ–¹å¼ï¼ˆgetï¼Œputç­‰ï¼‰æ¥ä½¿ç”¨å®ƒã€‚</p>

<pre><code class="language-html">&lt;!-- public/index.html --&gt;

       &lt;script&gt;
           new Vue({
               el: 'body',

               data: {
                   tasks: [],
                   newTask: {}
               },

         // This is run whenever the page is loaded to make sure we have a current task list
               created: function() {
       // Use the vue-resource $http client to fetch data from the /tasks route
                   this.$http.get('/tasks').then(function(response) {
                       this.tasks = response.data.items ? response.data.items : []
                   })
               },

               methods: {
                   createTask: function() {
                       if (!$.trim(this.newTask.name)) {
                           this.newTask = {}
                           return
                       }

            // Post the new task to the /tasks route using the $http client
                       this.$http.put('/tasks', this.newTask).success(function(response) {
                           this.newTask.id = response.created
                           this.tasks.push(this.newTask)
                           console.log(&quot;Task created!&quot;)
                           console.log(this.newTask)
                           this.newTask = {}
                       }).error(function(error) {
                           console.log(error)
                       });
                   },

                   deleteTask: function(index) {
            // Use the $http client to delete a task by its id
                       this.$http.delete('/tasks/' + this.tasks[index].id).success(function(response) {
                           this.tasks.splice(index, 1)
                           console.log(&quot;Task deleted!&quot;)
                       }).error(function(error) {
                           console.log(error)
                       })
                   }
               }
           })
       &lt;/script&gt;
</code></pre>

<h2>è¿è¡Œ</h2>

<p>ç°åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå·²ç»å®Œæˆäº†ã€‚æˆ‘ä»¬éœ€è¦ç¼–è¯‘ç„¶åè¿è¡Œå®ƒã€‚</p>

<pre><code class="language-shell">$ go build todo.go
$ ./todo
</code></pre>

<p>ç„¶åæ‰“å¼€ â€œ<a href="http://localhost:8000">http://localhost:8000</a>&ldquo;ã€‚</p>

<p><img src="/images/create-a-single-page-app-with-go-echo-and-vue/5RyzqEVWTUS6BEmf7eQA_ui_final.png" alt="" /></p>

<h2>æ€»ç»“</h2>

<p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨ Echo æ¡†æ¶å’Œ VueJS åˆ›å»ºå‰ç«¯é¡µé¢å’Œç®€å•çš„ Go åç«¯åº”ç”¨ã€‚ å¸Œæœ›è¿™ä¼šæ¿€èµ·ä½ å¯¹ Go è¯­è¨€çš„å¥½å¥‡å¿ƒï¼Œå¹¶æ¿€åŠ±ä½ å»ºç«‹æ›´å¤æ‚çš„ Web åº”ç”¨ã€‚</p>

<h2>åŸæ–‡é“¾æ¥</h2>

<p><a href="https://scotch.io/tutorials/create-a-single-page-app-with-go-echo-and-vue">Create a Single Page App With Go, Echo and Vue</a></p>

                    </div>
                    <footer class="article-footer">
                      <a href="https://qichengzx.github.io/2018/05/13/create-a-single-page-app-with-go-echo-and-vue.html#comments" class="article-comment-link">Comments</a>
                      
                        <ul class="article-tag-list">
                        
                          <li class="article-tag-list-item">
                            <a class="article-tag-list-link" href="/tags/go">go</a>
                          </li>
                        
                          <li class="article-tag-list-item">
                            <a class="article-tag-list-link" href="/tags/vue">vue</a>
                          </li>
                        
                        </ul>
                      
                    </footer>
                  </div>
                  <nav id="article-nav">
                    

                    
                  </nav>
                </article>

        
        
                <article id="96b350bd4cec62c1deddb413d8fcc85d" class="article" itemscope itemprop="blogPost">
                  <div class="article-meta">
                    <a href="https://qichengzx.github.io/2018/05/12/generating-random-keys-with-keygen.html" class="article-date">
                      <time itemprop="datePublished">2018-05-12 21:36:07</time>
                    </a>
                    <div class="article-category">
                      <a class="article-category-link" href="/categories/php">php</a>
                    </div>
                  </div>
                  <div class="article-inner">
                    <header class="article-header">
                      <h1 itemprop="name">
                        <a class="article-title" href="https://qichengzx.github.io/2018/05/12/generating-random-keys-with-keygen.html">Keygen åŒ…ç®€ä»‹</a>
                      </h1>
                    </header>
                    <div class="article-entry" itemprop="articleBody">
                      <p>æœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡éœ€è¦ç”Ÿæˆéšæœºå­—ç¬¦ä¸²ï¼Œæ•°å­—ç”šè‡³å­—èŠ‚ï¼Œä¾‹å¦‚ï¼šç”¨æˆ·IDï¼ŒAPIå¯†é’¥ï¼ŒéªŒè¯ä»¤ç‰Œç­‰ã€‚è‡ªå·±å†™ç”Ÿæˆç®—æ³•çš„è¯æ¯”è¾ƒéº»çƒ¦ï¼Œä»Šå¤©æ­£å¥½çœ‹åˆ° Keygen åŒ…å¯ä»¥è½»æ¾å®Œæˆè¿™äº›ã€‚</p>

<p>ç®€å•è®°å½•ä¸€äº›ç”¨æ³•ã€‚</p>

<h3>å®‰è£… Keygen</h3>

<p>ä½¿ç”¨ composer å®‰è£…ï¼š</p>

<pre><code>composer require gladcodes/keygen
</code></pre>

<h3>ç”Ÿæˆæ•°å­—</h3>

<p>æ•°å­—é€šå¸¸ç”¨æ¥ä½œä¸º IDã€‚å¯ä»¥é€šè¿‡è°ƒç”¨ Keygen\Keygen ç±»çš„ <code>numeric()</code> æ–¹æ³•ç”Ÿæˆã€‚å®ƒå¸¦æœ‰ä¸€ä¸ªå¯é€‰çš„é•¿åº¦å‚æ•°ï¼Œç”¨æ¥æŒ‡å®šæ•°å­—çš„é•¿åº¦ï¼Œå¦‚æœçœç•¥æˆ–è€…æ ¼å¼é”™è¯¯ï¼Œåˆ™é»˜è®¤ä¸º16ã€‚</p>

<pre><code class="language-php">&lt;?php

require __DIR__ . '/vendor/autoload.php';
use Keygen\Keygen;

$id_12 = Keygen::numeric(12)-&gt;generate();
$id_16 = Keygen::numeric()-&gt;generate();

echo $id_12; // 011683218639
echo $id_16; // 9352941287643963
</code></pre>

<p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸ä¼šä½¿ç”¨é›¶å¼€å¤´çš„æ•°å­—ã€‚éœ€è¦å¯¹ä»£ç è¿›è¡Œç»†å¾®çš„ä¿®æ”¹ï¼Œä»¥ç¡®ä¿åœ¨æ•°å­—çš„å¼€å¤´æ²¡æœ‰é›¶ã€‚ ä»¥ä¸‹ä»£ç ç‰‡æ®µåˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰å‡½æ•°æ¥åŒ…è£…ç”Ÿæˆæœºåˆ¶ã€‚</p>

<pre><code class="language-php">&lt;?php

require __DIR__ . '/vendor/autoload.php';
use Keygen\Keygen;

function generateID($length = null) {
    $length = is_int($length) ? $length : null;

    return Keygen::numeric($length - 1)-&gt;prefix(mt_rand(1, 9))-&gt;generate(true);
}

$id_12 = generateID(12);
$id_16 = generateID();

echo $id_12; // 473840499215
echo $id_16; // 2684603281019122
</code></pre>

<p>ä¸Šé¢çš„ä»£ç ä½¿ç”¨ <code>prefix()</code> æ–¹æ³•åœ¨æ•°å­—çš„å¼€å¤´æ·»åŠ ä¸€ä¸ªéé›¶æ•´æ•°ã€‚Keygen è½¯ä»¶åŒ…è¿˜æä¾›äº†ä¸€ä¸ª <code>suffix()</code> æ–¹æ³•ï¼Œç”¨äºåœ¨ç”Ÿæˆçš„å¯†é’¥æœ«å°¾æ·»åŠ å­—ç¬¦ã€‚ æœ‰å…³ Keygen è½¯ä»¶åŒ…åŠŸèƒ½çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼šKey Affixes å’Œ Key Transformationsï¼Œè¯·å‚é˜… Keygen è½¯ä»¶åŒ…çš„ <a href="https://github.com/gladchinda/keygen-php/blob/master/README.md">README</a> æ–‡æ¡£ã€‚</p>

<h3>ç”Ÿæˆå­—ç¬¦ä¸²å’Œ Token</h3>

<p>å­—ç¬¦ä¸²æ˜¯åŒ…å«å¤§å†™å­—æ¯ï¼Œå°å†™å­—æ¯å’Œæ•°å­—ç»„åˆçš„éšæœºå­—ç¬¦åºåˆ—ã€‚å®ƒå¯ä»¥é€šè¿‡é™æ€è°ƒç”¨ <code>Keygen\Keygen</code> ç±»çš„ <code>alphanum()</code> æ–¹æ³•ç”Ÿæˆï¼Œå…¶æ–¹æ³•ä¸ <code>numeric()</code> æ–¹æ³•éå¸¸ç›¸ä¼¼ã€‚</p>

<p>Token æ˜¯éšæœºçš„ base64 ç¼–ç çš„å­—ç¬¦ä¸²ã€‚å®ƒé€šå¸¸ç”¨ä½œåº”ç”¨ç¨‹åºçš„ç§˜å¯†å’Œ API å¯†é’¥ã€‚å®ƒå¯ä»¥ç”± <code>Keygen\Keygen</code> ç±»çš„ <code>token()</code> æ–¹æ³•ç”Ÿæˆã€‚</p>

<pre><code class="language-php">&lt;?php

require __DIR__ . '/vendor/autoload.php';
use Keygen\Keygen;

$alnum = Keygen::alphanum(15)-&gt;generate();
$token = Keygen::token(28)-&gt;generate();

echo $alnum; // TFd5X74Pr9ZOiG2
echo $token; // 4HE1xQz+4ks0Td128KSO/kBivd79
</code></pre>

<h3>ç”Ÿæˆéšæœºå­—èŠ‚</h3>

<p>è¿˜é€šè¿‡è°ƒç”¨ <code>Keygen\Keygen</code> ç±»çš„ <code>bytes()</code> æ–¹æ³•æ¥ç”Ÿæˆéšæœºå­—èŠ‚ã€‚</p>

<p>ä¸€èˆ¬æƒ…å†µä¸‹éšæœºå­—èŠ‚ä¸æ˜¯å¾ˆæœ‰ç”¨ï¼Œæ‰€ä»¥ï¼ŒKeygen åŒ…æä¾›äº†åå…­è¿›åˆ¶ï¼ˆhexï¼‰çš„éšæœºå­—èŠ‚çš„ <code>hex()</code> æ–¹æ³•ã€‚</p>

<pre><code class="language-php">&lt;?php

require __DIR__ . '/vendor/autoload.php';
use Keygen\Keygen;

$bytes = Keygen::bytes(20)-&gt;generate();
$hex = Keygen::bytes(20)-&gt;hex()-&gt;generate();

echo $bytes; // 
echo $hex; // 9f802a80aaf4b5e89e14
</code></pre>

<h3>å€¼ç±»å‹è½¬æ¢</h3>

<p>Keygen è½¯ä»¶åŒ…å…è®¸åœ¨ç”Ÿæˆå¯†é’¥ä¹‹å‰å¯¹å¯†é’¥åšä¸€æ¬¡æˆ–å¤šæ¬¡è½¬æ¢ã€‚è½¬æ¢åªæ˜¯ä¸€ç§å¯è°ƒç”¨çš„æ–¹æ³•ï¼Œå¯ä»¥å°†ç”Ÿæˆçš„é”®ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°å¹¶è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ æ¯æ¬¡è½¬æ¢åœ¨ç”Ÿæˆçš„å¯†é’¥ä¸ŠæŒ‰ç…§å®ƒä»¬åœ¨è¿”å›å¯†é’¥å‰æŒ‡å®šçš„é¡ºåºæ‰§è¡Œã€‚</p>

<pre><code class="language-php">&lt;?php

require __DIR__ . '/vendor/autoload.php';
use Keygen\Keygen;

$reference = Keygen::numeric(20)-&gt;generate(function($key) {
    return join('-', str_split($key, 4));
});

$filename = Keygen::bytes()-&gt;suffix('.png')-&gt;generate(true, ['strrev', function($key) {
    return substr(md5($key), mt_rand(0,8), 20);
}], 'strtoupper');

echo $reference; // 2129-1489-0676-5152-9337
echo $filename; // 159D702E346F74E3F0B6.png
</code></pre>

                    </div>
                    <footer class="article-footer">
                      <a href="https://qichengzx.github.io/2018/05/12/generating-random-keys-with-keygen.html#comments" class="article-comment-link">Comments</a>
                      
                        <ul class="article-tag-list">
                        
                          <li class="article-tag-list-item">
                            <a class="article-tag-list-link" href="/tags/Keygen">Keygen</a>
                          </li>
                        
                          <li class="article-tag-list-item">
                            <a class="article-tag-list-link" href="/tags/php">php</a>
                          </li>
                        
                        </ul>
                      
                    </footer>
                  </div>
                  <nav id="article-nav">
                    

                    
                  </nav>
                </article>

        
        
                <article id="7eaeed60817c1b34fd02764d44aefb24" class="article" itemscope itemprop="blogPost">
                  <div class="article-meta">
                    <a href="https://qichengzx.github.io/2018/05/10/git-rebase.html" class="article-date">
                      <time itemprop="datePublished">2018-05-10 15:18:29</time>
                    </a>
                    <div class="article-category">
                      <a class="article-category-link" href="/categories/git">git</a>
                    </div>
                  </div>
                  <div class="article-inner">
                    <header class="article-header">
                      <h1 itemprop="name">
                        <a class="article-title" href="https://qichengzx.github.io/2018/05/10/git-rebase.html">Git rebase ç¬”è®°</a>
                      </h1>
                    </header>
                    <div class="article-entry" itemprop="articleBody">
                      <p>Git åˆå¹¶ä»£ç æœ‰ mergeå’Œ rebase ä¸¤ç§é€‰æ‹©ï¼Œä¸ªäººè§‚ç‚¹æ˜¯ï¼Œmerge ä¸€èˆ¬ç”¨æ¥åˆå¹¶ä¸¤ä¸ªåˆ†æ”¯ï¼Œè€Œ rebase ä¸€èˆ¬ç”¨æ¥åˆå¹¶ commitã€‚</p>

<p>æœ€è¿‘åœ¨ç»™ mattermost é¡¹ç›®æäº¤ PR çš„æ—¶å€™è¢«è¦æ±‚ rebase ï¼Œæ“ä½œäº†å‡ æ¬¡éƒ½ä¸æˆåŠŸï¼Œåæ¥ä»”ç»†çœ‹äº†æ–‡æ¡£æ‰æ­£ç¡®åˆå¹¶ï¼Œæ‰€ä»¥åˆäº†ä»¥ä¸‹è®°å½•ã€‚</p>

<p>å¦‚æœæœ‰4æ¬¡æäº¤ï¼Œhashåˆ†åˆ«æ˜¯</p>

<pre><code>commit1 ---&gt; be8ad5c
commit2 ---&gt; 57939ce
commit3 ---&gt; 64be23a
commit4 ---&gt; e0788e4
</code></pre>

<p>å¦‚æœæƒ³æŠŠcommit4åˆå¹¶åˆ°commit3ï¼Œ</p>

<pre><code>git rebase -i 57939ce


pick 64be23a commit 3
pick e0788e4 commit 4
</code></pre>

<p>ä¸‹æ–¹ä¼šæœ‰æ“ä½œçš„æ³¨é‡Š</p>

<pre><code># s, squash = use commit, but meld into previous commit
</code></pre>

<p>å¯¹äºæƒ³è¦åˆå¹¶çš„commitï¼Œä½¿ç”¨sæ“ä½œï¼Œ
å³</p>

<pre><code>pick 64be23a commit 3
s e0788e4 commit 4
</code></pre>

<p>ä¿å­˜åï¼Œä¼šè¿›å…¥äº¤äº’ç¼–è¾‘æ¨¡å¼</p>

<pre><code># This is a combination of 2 commits.
# This is the 1st commit message:

commit 3

# This is the commit message #2:

commit 4
</code></pre>

<p>è¡¨ç¤ºå°†è¦åˆå¹¶ä¸¤ä¸ªcommitï¼Œå¯ä»¥ä¿®æ”¹æˆ–ä¸ä¿®æ”¹commitå†…å®¹ï¼Œä¿å­˜åï¼Œä¸¤æ¬¡commitå³åˆå¹¶æˆä¸€ä¸ªcommitäº†ã€‚</p>

<p>è¿™æ ·ï¼Œåœ¨ git çš„æäº¤å†å²é‡Œä¾¿æ²¡æœ‰äº† commit 4 è¿™æ¬¡æäº¤ã€‚</p>

<h5>å‚è€ƒèµ„æ–™ï¼š</h5>

<p><a href="https://git-scm.com/book/zh/v2/Git-%E5%88%86%E6%94%AF-%E5%8F%98%E5%9F%BA">Git åˆ†æ”¯ - å˜åŸº</a></p>

                    </div>
                    <footer class="article-footer">
                      <a href="https://qichengzx.github.io/2018/05/10/git-rebase.html#comments" class="article-comment-link">Comments</a>
                      
                        <ul class="article-tag-list">
                        
                          <li class="article-tag-list-item">
                            <a class="article-tag-list-link" href="/tags/git">git</a>
                          </li>
                        
                        </ul>
                      
                    </footer>
                  </div>
                  <nav id="article-nav">
                    

                    
                  </nav>
                </article>

        

        
        


<nav id="page-nav">








  <a class="page-number" href="/">1</a>



  <a class="page-number" href="/page/2/">2</a>



  <a class="page-number" href="/page/3/">3</a>



  <a class="page-number" href="/page/4/">4</a>



  <a class="page-number" href="/page/5/">5</a>



  <a class="page-number" href="/page/6/">6</a>



  <a class="page-number" href="/page/7/">7</a>




  <a class="extend next" rel="next" href="/page/2/">Next Â»</a>

</nav>


        
      
      </section>
      
      
            <aside id="sidebar">
            
    
                <div class="widget-wrap">
                  <h3 class="widget-title">Categories</h3>
                  <div class="widget">
                    <ul class="category-list">
                      
                      
                      <li class="category-list-item">
                        <a class="category-list-link" href="/categories/default/">default</a>
                        <span class="category-list-count">9</span>
                      </li>
                      
                      <li class="category-list-item">
                        <a class="category-list-link" href="/categories/git/">git</a>
                        <span class="category-list-count">3</span>
                      </li>
                      
                      <li class="category-list-item">
                        <a class="category-list-link" href="/categories/golang/">golang</a>
                        <span class="category-list-count">24</span>
                      </li>
                      
                      <li class="category-list-item">
                        <a class="category-list-link" href="/categories/javascript/">javascript</a>
                        <span class="category-list-count">7</span>
                      </li>
                      
                      <li class="category-list-item">
                        <a class="category-list-link" href="/categories/linux/">linux</a>
                        <span class="category-list-count">1</span>
                      </li>
                      
                      <li class="category-list-item">
                        <a class="category-list-link" href="/categories/mysql/">mysql</a>
                        <span class="category-list-count">4</span>
                      </li>
                      
                      <li class="category-list-item">
                        <a class="category-list-link" href="/categories/nginx/">nginx</a>
                        <span class="category-list-count">1</span>
                      </li>
                      
                      <li class="category-list-item">
                        <a class="category-list-link" href="/categories/php/">php</a>
                        <span class="category-list-count">12</span>
                      </li>
                      
                    </ul>
                  </div>
                </div>
    

            
    
                <div class="widget-wrap">
                  <h3 class="widget-title">Tags</h3>
                  <div class="widget">
                    <ul class="tag-list">
                      
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/ECharts/">ECharts</a>
                        <span class="tag-list-count">1</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/Keygen/">Keygen</a>
                        <span class="tag-list-count">1</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/captcha/">captcha</a>
                        <span class="tag-list-count">1</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/crontab/">crontab</a>
                        <span class="tag-list-count">1</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/discuz/">discuz</a>
                        <span class="tag-list-count">1</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/docker/">docker</a>
                        <span class="tag-list-count">2</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/dropbox/">dropbox</a>
                        <span class="tag-list-count">2</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/excel/">excel</a>
                        <span class="tag-list-count">1</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/fetch/">fetch</a>
                        <span class="tag-list-count">1</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/geo/">geo</a>
                        <span class="tag-list-count">3</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/gin/">gin</a>
                        <span class="tag-list-count">1</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/git/">git</a>
                        <span class="tag-list-count">3</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/github/">github</a>
                        <span class="tag-list-count">1</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/go/">go</a>
                        <span class="tag-list-count">24</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/goquery/">goquery</a>
                        <span class="tag-list-count">2</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/hexo/">hexo</a>
                        <span class="tag-list-count">3</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/https/">https</a>
                        <span class="tag-list-count">1</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/input/">input</a>
                        <span class="tag-list-count">1</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/javascript/">javascript</a>
                        <span class="tag-list-count">3</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/js/">js</a>
                        <span class="tag-list-count">2</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/laravel/">laravel</a>
                        <span class="tag-list-count">1</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/leetcode/">leetcode</a>
                        <span class="tag-list-count">1</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/linux/">linux</a>
                        <span class="tag-list-count">1</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/mysql/">mysql</a>
                        <span class="tag-list-count">7</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/nginx/">nginx</a>
                        <span class="tag-list-count">1</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/node/">node</a>
                        <span class="tag-list-count">1</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/pdo/">pdo</a>
                        <span class="tag-list-count">1</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/php/">php</a>
                        <span class="tag-list-count">14</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/qq/">qq</a>
                        <span class="tag-list-count">1</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/rabbitmq/">rabbitmq</a>
                        <span class="tag-list-count">6</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/react-native/">react-native</a>
                        <span class="tag-list-count">1</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/redigo/">redigo</a>
                        <span class="tag-list-count">3</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/redis/">redis</a>
                        <span class="tag-list-count">5</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/rust/">rust</a>
                        <span class="tag-list-count">1</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/ssl/">ssl</a>
                        <span class="tag-list-count">1</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/time/">time</a>
                        <span class="tag-list-count">1</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/vps/">vps</a>
                        <span class="tag-list-count">1</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/vue/">vue</a>
                        <span class="tag-list-count">1</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/widget/">widget</a>
                        <span class="tag-list-count">1</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/%e4%bb%8a%e6%97%a5%e5%a4%b4%e6%9d%a1/">ä»Šæ—¥å¤´æ¡</a>
                        <span class="tag-list-count">1</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/%e6%a0%87%e8%af%86%e7%ac%a6/">æ ‡è¯†ç¬¦</a>
                        <span class="tag-list-count">1</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/%e7%88%b1%e5%a5%87%e8%89%ba/">çˆ±å¥‡è‰º</a>
                        <span class="tag-list-count">1</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/%e7%9f%ad%e7%bd%91%e5%9d%80/">çŸ­ç½‘å€</a>
                        <span class="tag-list-count">1</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/%e7%b3%97%e7%99%be/">ç³—ç™¾</a>
                        <span class="tag-list-count">1</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/%e7%bd%91%e7%bb%9c%e8%af%b7%e6%b1%82/">ç½‘ç»œè¯·æ±‚</a>
                        <span class="tag-list-count">1</span>
                      </li>
                      
                      <li class="tag-list-item">
                        <a class="tag-list-link" href="/tags/%e9%98%9f%e5%88%97/">é˜Ÿåˆ—</a>
                        <span class="tag-list-count">1</span>
                      </li>
                      
                    </ul>
                  </div>
                </div>
    

            
    
            <div class="widget-wrap">
              <h3 class="widget-title">Archives</h3>
              <div class="widget">
                <ul class="archive-list">
                  
                  
                  <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2015/11">2015/11</a>
                    <span class="archive-list-count">7</span>
                  </li>
                  
                  <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2015/12">2015/12</a>
                    <span class="archive-list-count">4</span>
                  </li>
                  
                  <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2016/01">2016/01</a>
                    <span class="archive-list-count">3</span>
                  </li>
                  
                  <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2016/02">2016/02</a>
                    <span class="archive-list-count">4</span>
                  </li>
                  
                  <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2016/04">2016/04</a>
                    <span class="archive-list-count">4</span>
                  </li>
                  
                  <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2016/05">2016/05</a>
                    <span class="archive-list-count">3</span>
                  </li>
                  
                  <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2016/07">2016/07</a>
                    <span class="archive-list-count">1</span>
                  </li>
                  
                  <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2016/09">2016/09</a>
                    <span class="archive-list-count">3</span>
                  </li>
                  
                  <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2016/10">2016/10</a>
                    <span class="archive-list-count">1</span>
                  </li>
                  
                  <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2016/11">2016/11</a>
                    <span class="archive-list-count">1</span>
                  </li>
                  
                  <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2016/12">2016/12</a>
                    <span class="archive-list-count">3</span>
                  </li>
                  
                  <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2017/03">2017/03</a>
                    <span class="archive-list-count">1</span>
                  </li>
                  
                  <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2017/06">2017/06</a>
                    <span class="archive-list-count">1</span>
                  </li>
                  
                  <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2017/07">2017/07</a>
                    <span class="archive-list-count">2</span>
                  </li>
                  
                  <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2017/08">2017/08</a>
                    <span class="archive-list-count">1</span>
                  </li>
                  
                  <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2017/09">2017/09</a>
                    <span class="archive-list-count">3</span>
                  </li>
                  
                  <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2017/11">2017/11</a>
                    <span class="archive-list-count">1</span>
                  </li>
                  
                  <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2018/02">2018/02</a>
                    <span class="archive-list-count">4</span>
                  </li>
                  
                  <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2018/04">2018/04</a>
                    <span class="archive-list-count">2</span>
                  </li>
                  
                  <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2018/05">2018/05</a>
                    <span class="archive-list-count">6</span>
                  </li>
                  
                  <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2018/06">2018/06</a>
                    <span class="archive-list-count">1</span>
                  </li>
                  
                  <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2019/01">2019/01</a>
                    <span class="archive-list-count">1</span>
                  </li>
                  
                  <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2020/02">2020/02</a>
                    <span class="archive-list-count">1</span>
                  </li>
                  
                  <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2021/01">2021/01</a>
                    <span class="archive-list-count">1</span>
                  </li>
                  
                  <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2021/07">2021/07</a>
                    <span class="archive-list-count">1</span>
                  </li>
                  
                  <li class="archive-list-item">
                    <a class="archive-list-link" href="/archives/2025/01">2025/01</a>
                    <span class="archive-list-count">1</span>
                  </li>
                  
                </ul>
              </div>
            </div>
    

            
    
            <div class="widget-wrap">
              <h3 class="widget-title">RECENTS</h3>
              <div class="widget">
                <ul>
                  
                  <li>
                    <a href="https://qichengzx.github.io/2025/01/12/08-rustlings-enums.html">08-rustlings-enums</a>
                  </li>
                  
                  <li>
                    <a href="https://qichengzx.github.io/2021/07/18/pipeline-pattern-in-go-part-1.html">Go æµæ°´çº¿æ¨¡å¼</a>
                  </li>
                  
                  <li>
                    <a href="https://qichengzx.github.io/2021/01/01/unmarshaling-time-values-from-json.html">Go json æ—¶é—´æ ¼å¼è§£æ</a>
                  </li>
                  
                  <li>
                    <a href="https://qichengzx.github.io/2020/02/02/graceful-shutdown-of-a-tcp-server-in-go.html">ä¼˜é›…çš„å…³é—­Go TCP Server</a>
                  </li>
                  
                  <li>
                    <a href="https://qichengzx.github.io/2019/01/01/go-in-the-browser.html">ã€è¯‘ã€‘Goå’ŒWebAssemblyï¼šåœ¨æµè§ˆå™¨ä¸­è¿è¡ŒGoç¨‹åº</a>
                  </li>
                  
                </ul>
              </div>
            </div>
    

            </aside>

      
    </div>
    
        <footer id="footer">
          <div class="outer">
            <div id="footer-info" class="inner">
              &copy; 2025 å¯ç¨‹<br>
              Powered by <a href="https://github.com/qichengzx/gopress" target="_blank">gopress</a>
            </div>
            </div>
        </footer>

  </div>
  
<nav id="mobile-nav">
  
  <a class="mobile-nav-link" href="/">Home</a>
  
  <a class="mobile-nav-link" href="/archives">Archives</a>
  
  <a class="mobile-nav-link" href="https://github.com/qichengzx">GitHub</a>
  
</nav>

  

<script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>


</div>
</body>
</html>
